<!DOCTYPE html>
<html lang="ru">
<head>
  <title>Debian 7 или Какого лешего</title>
  <meta charset="utf-8">
<meta name="description" content="Debian — первый серьёзный дистрибутив автора, тёплая и нежная дружба с которым длилась достаточно долго, до перехода на archlinux."><meta name="author" content="redVi">  <meta name="viewport" content="initial-scale=1.0, width=device-width" />
  <link href="http://www.unix-lab.org/theme/css/screen.css" rel="stylesheet" type="text/css" />
  <meta name='yandex-verification' content='494a81ecb0e796d6' />
  <link rel="icon" href="http://www.unix-lab.org/favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="http://www.unix-lab.org/favicon.ico" type="image/x-icon">
  <link href="http://www.unix-lab.org/" type="application/atom+xml" rel="alternate" title="unix-lab.org ATOM Feed" />
  <link href="http://www.unix-lab.org/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="unix-lab.org RSS Feed" />
</head>
<body>
<div id="outer-wrapper">
<div id="header-wrapper">
    <a href="http://www.unix-lab.org"><div class="logo"></div></a>
    <div class="small">блог об операционных системах, open source и программировании</div>
<div class="nav">
    <ul>
      <li><a href="http://www.unix-lab.org/archives/">Архив</a></li>
      <li><a href="http://www.unix-lab.org/about/">О блоге</a></li>
      <li><a href="http://www.unix-lab.org/authors/">Автор</a></li>
    </ul>
</div>
</div><div id="main">
<h2><a href="http://www.unix-lab.org/articles/debian-wheezy.html">Debian 7 или Какого лешего</a></h2>
<h5><i class="icon-feather"></i> 22 Июнь 2013
<i class="icon-bookmarks"></i> <a href="http://www.unix-lab.org/tag/debian/">Debian</a> /
<a href="http://www.unix-lab.org/tag/linux/">Linux</a> /
</h5>
<p>Debian — первый серьёзный дистрибутив автора, тёплая и нежная дружба с которым длилась достаточно долго, до перехода на archlinux. Помнится, просидев на Ubuntu пару месяцев и смекнув, что с этим дистрибутивом ничему толком не научишься (ибо не способствует он получению новых знаний в освоении linux — слишком дружелюбен и услужлив, с ним даже не приходится знать, что такое консоль), зимой 2009 года на домашний компьютер было решено поставить Debian. Много воды утекло с тех пор, много дистрибутивов было испробовано и теперь, после выхода Debian Wheezy, захотелось снова взглянуть на старого друга... да не тут-то было. Впечатления он оставил, прямо-таки скажем, неоднозначные.</p>
<p>Действия <a href="http://www.root-inform.blogspot.ru/2011/09/linux_6591.html">по загрузке и установке дистрибутива</a> уже были описаны ранее также, как и <a href="http://www.unix-lab.org/acpi/">настройка энергопотребления</a>. Ничего кардинально нового замечено не было, поэтому начнём с экрана приветствия. По ходу установки из трёх возможных графических сред был выбран xfce, который и встретил своим нерусифицированным хмурым лицом. Вбив логин и пароль, оставалось только войти в систему и воскликнуть: «Какого лешего?». Отсутствие русификации, отвратительные шрифты, невозможность установить некоторые полюбившиеся уже приложения и предложение довольствоваться их устаревшими аналогами... много любопытного поджидает путешественников в мир Debian. Упёртость не позволила бросить дистрибутив. Оставить же его в виде «как есть» не позволила совесть.</p>
<h2>Шаг первый: замена ядра</h2>
<p>Прежде всего следовало разобраться с ядром, в котором мало того, что не была использована возможность переключения между видеокартами, так она вообще ещё не поддерживалась: версия ядра 3.2. Выйти из положения можно двумя способами: либо установить свежее дистрибутивное ядро (с патчами от разработчиков самого debian), либо собрать ванильное.</p>
<p>Сначала приводистя пример установки ядра из backports (хотя нет, и там тухло) или лучше из  experimental — единственной ветки, где имеется софт без бороды.
Подключаем один из последних двух репозиториев:</p>
<div class="highlight"><pre><span class="c"># /etc/apt/source.list</span>

deb http://debian.nsu.ru/debian/ wheezy main non-free contrib
deb-src http://debian.nsu.ru/debian/ wheezy main non-free contrib
deb http://security.debian.org/ wheezy/updates main contrib non-free
deb-src http://security.debian.org/ wheezy/updates main contrib non-free
deb http://debian.org/debian/ wheezy-backports main
deb http://ftp.debian.org/debian experimental main
</pre></div>


<p>Даём debian'у сигнал о том, что список репозиториев обновился</p>
<div class="highlight"><pre><span class="gp">#</span> aptitude update
</pre></div>


<p>Ставим свежее ядро. В примере из ветки experimental:</p>
<div class="highlight"><pre><span class="gp">#</span> aptitude search linux-image
<span class="gp">#</span> apt-get -t experimental install linux-image-3.8
</pre></div>


<p>Следующий метод предназначен для тех, кто как и автор поста, плюнув на ядра дистрибутива, захочет отправится в путь за ванильным ядром на kernel.org. Как это оговаривалось уже не раз в других заметках, нужно скачать последнюю стабильную версию ядра и распаковать её в <code>/usr/src</code>:</p>
<div class="highlight"><pre><span class="gp">$</span> wget -c http://kernel.org/pub/linux/kernel/v3.x/linux-3.8.11.tar.xz
<span class="gp">#</span> mv linux-3.8.11.tar.xz /usr/src
<span class="gp">#</span> tar xvf linux-3.8.11.tar.xz
</pre></div>


<p>После чего собрать ядро с нужными параметрами и дать команду на сборку и установку самого ядра, а также всех его модулей:</p>
<div class="highlight"><pre><span class="gp">#</span> make menuconfig
<span class="gp">#</span> make bzImage modules modules_install install
</pre></div>


<p>В результате в <code>/boot</code> разделе должно появиться ядро с указанной версией и его загрузочный образ (initrd). Дебиан даже потрудился перконфигурировать настройки загрузчика grub2, найдя и включив новое ядро в список. Впрочем, вышеуказанные действия легко выполнить и вручную, сгенерировать образ и обновить настройки загрузчика можно двумя соответствующими командами:</p>
<div class="highlight"><pre><span class="gp">#</span> mkinitramfs -o /boot/initrd-3.8.11
<span class="gp">#</span> grub-mkconfig -o /boot/grub/grub.cfg
</pre></div>


<p><img alt="grub-mkconfig" src="http://1.bp.blogspot.com/-93majm8ZPWs/UYjjkIN9gII/AAAAAAAAEuY/surD6dR9_m4/s1600/mkconfig.png" /></p>
<p>Чтобы добиться искомого результата (отключить дискретное видео), нужно сделать ещё несколько телодвижений:</p>
<p><code>1.</code> Убедиться, что установлен драйвер видеокарты, применительно к intel выглядит так:</p>
<div class="highlight"><pre><span class="gp">$</span> aptitude search intel
<span class="go">i A libdrm-intel i A xserver-xorg-video-intel</span>
</pre></div>


<p>Если установленных пакетов не найдено, доустановить их.</p>
<p><code>2.</code> Установить <code>linux-firmware-nonfree</code></p>
<p><code>3.</code> Добавить debugfs в <code>/ets/fstab</code></p>
<div class="highlight"><pre><span class="n">none</span>  <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">debug</span> <span class="n">debugfs</span> <span class="n">defaults</span> <span class="mi">0</span> <span class="mi">0</span>
</pre></div>


<p><code>4.</code> Добавить скрипт в <code>/etc/rc.local</code>, вот так:</p>
<div class="highlight"><pre><span class="c"># By default this script does nothing</span>
<span class="nb">echo </span>OFF &gt; /sys/kernel/debug/vgaswitcheroo/switch
<span class="nb">exit </span>0
</pre></div>


<h2>Шаг второй: русификация интерфейса, настройки ввода</h2>
<p>Русификация всего и вся проходит быстро и безболезненно внесением одной лишь записи в <code>/etc/default/locale</code>:</p>
<div class="highlight"><pre><span class="nv">LANG</span><span class="o">=</span><span class="s2">&quot;ru_RU.UTF-8&quot;</span>
</pre></div>


<p>Следуя какой-то своей особой логике, Debian предлагает выбор русского языка при установке, но это никоим образом не отражается на практике: что ж, русифицируем самостоятельно.</p>
<p>Раскладки клавиатуры также не предлагают того, что хочется — не беда. Сделаем переключение через <code>Alt + Shift</code> , да чтобы раскладку было видно по индикатору <code>Caps Lock</code>.</p>
<p><img alt="layout" src="http://1.bp.blogspot.com/-qJBM-kr1uO4/UYjzLXk8TCI/AAAAAAAAEuo/7P2-PyXhqus/s1600/layout.jpg" /></p>
<p>Настройка раскладки клавиатуры, поведения тачпада... мелочи жизни:</p>
<div class="highlight"><pre><span class="c"># /etc/X11/xorg.conf.d/10-evdev.conf</span>
<span class="c">#</span>
Section <span class="s2">&quot;InputClass&quot;</span>
    Identifier <span class="s2">&quot;evdev keyboard catchall&quot;</span>
    MatchIsKeyboard <span class="s2">&quot;on&quot;</span>
    MatchDevicePath <span class="s2">&quot;/dev/input/event*&quot;</span>
Driver <span class="s2">&quot;evdev&quot;</span> EndSection


<span class="c"># /etc/X11/xorg.conf.d/20-keyboard-layout.conf</span>
<span class="c">#</span>
Section <span class="s2">&quot;InputClass&quot;</span>
    Identifier <span class="s2">&quot;Keyboard Defaults&quot;</span>
    MatchIsKeyboard <span class="s2">&quot;yes&quot;</span>
    Option <span class="s2">&quot;XkbLayout&quot;</span> <span class="s2">&quot;us,ru&quot;</span>
    Option <span class="s2">&quot;XkbOptions&quot;</span> <span class="s2">&quot;grp:alt_shift_toggle, grp_led:caps&quot;</span>
EndSection

<span class="c"># /etc/X11/xorg.conf.d/50-synaptics.conf</span>
<span class="c">#</span>
Section <span class="s2">&quot;InputClass&quot;</span>
    Identifier <span class="s2">&quot;touchpad catchall&quot;</span>
    Driver <span class="s2">&quot;synaptics&quot;</span>
    MatchIsTouchpad <span class="s2">&quot;on&quot;</span>
    Option <span class="s2">&quot;TapButton1&quot;</span> <span class="s2">&quot;1&quot;</span>
    Option <span class="s2">&quot;TapButton2&quot;</span> <span class="s2">&quot;2&quot;</span>
    Option <span class="s2">&quot;TapButton3&quot;</span> <span class="s2">&quot;3&quot;</span>
    Option <span class="s2">&quot;VertEdgeScroll&quot;</span> <span class="s2">&quot;on&quot;</span>
    Option <span class="s2">&quot;VertTwoFingerScroll&quot;</span> <span class="s2">&quot;on&quot;</span>
    Option <span class="s2">&quot;HorizEdgeScroll&quot;</span> <span class="s2">&quot;on&quot;</span>
    Option <span class="s2">&quot;HorizTwoFingerScroll&quot;</span> <span class="s2">&quot;on&quot;</span>
    Option <span class="s2">&quot;CircularScrolling&quot;</span> <span class="s2">&quot;on&quot;</span>
    Option <span class="s2">&quot;CircScrollTrigger&quot;</span> <span class="s2">&quot;2&quot;</span>
    Option <span class="s2">&quot;EmulateTwoFingerMinZ&quot;</span> <span class="s2">&quot;40&quot;</span>
    Option <span class="s2">&quot;EmulateTwoFingerMinW&quot;</span> <span class="s2">&quot;8&quot;</span>
    Option <span class="s2">&quot;CoastingSpeed&quot;</span> <span class="s2">&quot;0&quot;</span>
    MatchDevicePath <span class="s2">&quot;/dev/input/event*&quot;</span>
EndSection
    Section <span class="s2">&quot;InputClass&quot;</span>
    Identifier <span class="s2">&quot;touchpad ignore duplicates&quot;</span>
    MatchIsTouchpad <span class="s2">&quot;on&quot;</span>
    MatchOS <span class="s2">&quot;Linux&quot;</span>
    MatchDevicePath <span class="s2">&quot;/dev/input/mouse*&quot;</span>
    Option <span class="s2">&quot;Ignore&quot;</span> <span class="s2">&quot;on&quot;</span>
EndSection
    Section <span class="s2">&quot;InputClass&quot;</span>
    Identifier <span class="s2">&quot;Default clickpad buttons&quot;</span>
    MatchDriver <span class="s2">&quot;synaptics&quot;</span>
    Option <span class="s2">&quot;SoftButtonAreas&quot;</span> <span class="s2">&quot;50% 0 82% 0 0 0 0 0&quot;</span>
EndSection
</pre></div>


<h2>Шаг третий: настройка шрифтов</h2>
<p>Ни в одной другой ОС не доведётся неискушённому пользователю видеть такое ужасающее отображение шрифта как в Debian. Вообще, надо сказать, что шрифты были и во многом остаются главной проблемой всех linux-дистрибутивов. В последнее время исправить это досадное недоразумение призван патч infinality, который действительно может невозможное.</p>
<p>В debian имеется «куцая» утилита для настройки отображения шрифта. Возможности её довольно скудны. Для сравнения в gentoo при помощи eselect можно сделать намного-намного больше.</p>
<p><u>gentoo</u></p>
<p><img alt="gentoo" src="http://2.bp.blogspot.com/-vQ7G40in2A4/UYh0BHtdgBI/AAAAAAAAEtY/vhovYm_HVWo/s1600/eselect_infinality.png" /></p>
<p><u>debian</u></p>
<div class="highlight"><pre><span class="gp">$</span> sudo dpkg-reconfigure fontconfig-config
</pre></div>


<p><img alt="autohinter" src="http://1.bp.blogspot.com/-Aa5vY-sY4JY/UYh0hvFh65I/AAAAAAAAEtk/YUk3mNX_SY4/s1600/fontconfig.png" /></p>
<p><img alt="fontconfig" src="http://1.bp.blogspot.com/-Mnl9-oUrGNg/UYh0h358-2I/AAAAAAAAEtg/FDDHDcE9Fmk/s1600/fontconfig2.png" /></p>
<p><img alt="font-zoom" src="http://1.bp.blogspot.com/-yIOu7FSmpPs/UYh0h1LI3MI/AAAAAAAAEto/E14Lxyd67Yg/s1600/fontconfig3.png" /></p>
<p>Сразу нужно сказать, что вопрос со шрифтами решён не был, хотя сил приложено было немало. Ни установка <code>freefont2</code>, который в дебиане проходит с пометкой 'demo', ни попытка наложить готовый патч от <code>infinality</code> для Debian плодов не дали.
Для примера два скриншота одной и той же страницы, сделанных в Gentoo(firefox, снизу) и Debian(iceweasel, сверху). Шрифт в Debian не имеет сглаживания и выглядит разряженным. Дабы сравнение было правильно воспринято, рекомендуется сохранить оба скриншота и просмотреть их в размере 1:1.</p>
<ul>
<li>debian
<a href="http://2.bp.blogspot.com/-EwFAXDu4AdM/UYiXHd6fXJI/AAAAAAAAEuA/PaxXM7ucdns/s1600/debian-font-shot.png">смотреть в полном размере</a></li>
<li>gentoo
<a href="http://4.bp.blogspot.com/-iXYAds2KJRY/UYiXIjgkxhI/AAAAAAAAEuE/o3GOcVoEvd8/s1600/gentoo_fonts_screen.png">смотреть в полном размере</a></li>
</ul>
<p>Может быть, знающие линуксоиды наставят автора на путь истинный и укажут наиболее простое и красивое решение указанной проблемы. Всех, у кого есть здравые мысли на этот счёт, прошу выразить свою критику и негодование вместе с примерами настройки в комментариях. Но, сдаётся мне, без наложения патчей от Убунты здесь не обойтись.</p>
<h2>Шаг четвёртый: автозапуск</h2>
<p>Автор придерживается убеждения, что хороший дистрибутив не тот, который думает за пользователя, но тот, что даёт пользователю право выбора и право быть самодержцем в своей операционной системе. Такой дистибутив по определению должен быть прозрачен как слеза младенца и делать только то, что ему указано — ничего сверх этого. Наш друг Дебиан мало того, что славится своей устрашающей системой инициализации, так ещё и, с позволения сказать, шкодничает. При установке какого-либо демона он автоматически помещает его в автозапуск, чего хороший дистрибутив делать не станет. В итоге при инициализации системы происходит и запуск всех демонов, большинство из которых совершенно не нужны в повседневной работе. Таким образом, дабы система загружалась быстрее и поглощала меньше ресурсов, надобно всё лишнее поотключать.</p>
<p>Для этого нужно просмотреть список автозагрузки и выдернуть из него лишний хлам. Первое можно сделать, просмотрев содержимое каталога <code>/etc/init.d</code> либо используя утилиту <code>chkconfig</code>:</p>
<p><img alt="chkconfig" src="http://1.bp.blogspot.com/-UKkc4G74OgA/UYkS0sIU8HI/AAAAAAAAEvg/tD0qIz1V9mA/s1600/chkconfig-debian.png" /></p>
<p>Удалить из автозапуска: <code># update-rc.d -f cups remove</code> или <code># insserv -r cups (≥ debian 6)</code>, где <code>cups</code> — искомый демон.</p>
<p>Команда добавления в автозапуск, которая вряд ли когда-либо понадобится ввиду излишней интеллектуальности Дебиана:</p>
<div class="highlight"><pre><span class="gp">#</span> update-rc.d cups defaults <span class="c"># или insserv cups defaults (≥ debian 6)</span>
</pre></div>


<h2>Прочее</h2>
<p>Также были отмечены некоторые странности как то: в процессе установки была выбрана возможность входа от суперпользователя. Тем не менее, Debian не предложил создать для него пароль и при входе в систему рут оказался беспарольным. Разумеется, это тоже не представляет большой проблемы и исправляется командой <code>passwd</code>.</p>
<p>К странностям новой версии можно отнести добродушное пожелание ОС напоминать о выходе новой версии... Ubuntu. Но, скажите, какого лешего?</p>
<p><img alt="ubuntu in debian" src="http://2.bp.blogspot.com/-q-kLwrUVxik/UYkCZPE1rLI/AAAAAAAAEvI/vukqqbqupME/s1600/ubuntu_in_debian.png" /></p>
<p>С xfce сдружиться не получилось. В конечном варианте остался openbox, благодяря которому рабочий стол приобрёл приятный и в то же время минималистичный вид.</p>
<p><a href="http://farm6.staticflickr.com/5443/9503298406_5e31c888f3_o.png" data-lighter><img src="http://farm6.staticflickr.com/5443/9503298406_5e31c888f3_o.png"/></a></p>
<p>«Умолчательные» приложения не вдохновляют на совершение трудовых подвигов. Из нужного автору в огромном стандартном репозитории Debian'a не нашлось места для <code>spacefm, compton, sublime text 2</code>. Так на кой чёрт мне репозиторий в 37.000 пакетов, если в нём нет нескольких горячо любимых программ?</p>
<h2>Подведение итогов</h2>
<p>Собственно, зачем это всё затевалось? Во-первых, появилось желание одним глазком посмотреть на любимый когда-то дистрибутив. Во-вторых, возникла надобность поставить на внешний диск надёжную рабочую лошадку, не требующую ухода (таково моё мнение о Debain в целом). Надо также отметить, что данный пост, скорее всего, будет последним касающимся установки/настройки дистрибутива, если только автору не взбредёт в голову поставить Slackware Linux. Оставшиеся самобытные ОС — Gentoo, Archlinux — уже были рассмотрены ранее, иные же являются лишь их потомками, зачастую имеют простой графический установщик и мало чем отличаются в настройке.</p>
<p>Претензии к Wheezy:</p>
<ul>
<li>удручающе <code>старый софт</code> (прежде всего версия ядра)</li>
<li>невозможно без слёз смотреть на <code>шрифт</code></li>
<li>на то, что пользователи «красноглазых» дистрибутивов настраивают с пол-оборота, в дебиане приходится потратить <code>изрядное количество времени</code></li>
<li>нет <code>привычных проверенных программ</code>, которые широко используются в подавляющем большинстве дистрибутивов</li>
<li>система считает себя <code>умнее хозяина</code> (одна из причин, почему так много дружелюбных к пользователю дистрибутивов основано на Дебиане)</li>
</ul>
<p>Итог: ностальгия быстро улетучилась, Дебиан остался на внешнем жёстком диске в качестве запасной рабочей лошадки и бэкап-хранилища для <code>/home</code> каталога.</p>

<br />
<p align="center"><a href="#">наверх</a></p>
</div>
</div>
<div id="footer-wrapper">
<ul class="footer">
     <li class="footer"><a href="http://www.unix-lab.org/tag/android/">Android </a></li>
     <li class="footer"><a href="http://www.unix-lab.org/tag/arch/">Arch </a></li>
     <li class="footer"><a href="http://www.unix-lab.org/tag/blog/">Blog </a></li>
     <li class="footer"><a href="http://www.unix-lab.org/tag/debian/">Debian </a></li>
     <li class="footer"><a href="http://www.unix-lab.org/tag/decorations/">Decorations </a></li>
     <li class="footer"><a href="http://www.unix-lab.org/tag/editors/">Editors </a></li>
     <li class="footer"><a href="http://www.unix-lab.org/tag/gentoo/">Gentoo </a></li>
     <li class="footer"><a href="http://www.unix-lab.org/tag/git/">Git </a></li>
     <li class="footer"><a href="http://www.unix-lab.org/tag/kernel/">Kernel </a></li>
     <li class="footer"><a href="http://www.unix-lab.org/tag/latex/">LaTeX </a></li>
     <li class="footer"><a href="http://www.unix-lab.org/tag/linux/">Linux </a></li>
     <li class="footer"><a href="http://www.unix-lab.org/tag/python/">Python </a></li>
     <li class="footer"><a href="http://www.unix-lab.org/tag/server/">Server </a></li>
     <li class="footer"><a href="http://www.unix-lab.org/tag/web/">Web </a></li>
     <li class="footer"><a href="http://www.unix-lab.org/tag/windows/">Windows </a></li>
</ul><ul class="footer">
    <li class="footer">&copy;&nbsp;2011&mdash;2013&nbsp;::</li>
    <li class="footer"><a href="http://www.unix-lab.org">unix-lab.org </a>&nbsp;::</li>
    <li class="footer">Licensed under <a href="http://creativecommons.org/licenses/by-nc/3.0/deed.ru">CC BY-NC</a></li>
</ul>
</div><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-42400517-1', 'www.unix-lab.org');
  ga('send', 'pageview');

</script>
</body>
</html>