<!DOCTYPE html>
<html lang="ru">
<head>
  <title>Django: первые страницы</title>
  <meta charset="utf-8">
  <meta name="description" content="Пример первоначальной настройки и наполнения сайта на Django">  <meta name="author" content="redVi">  <meta name="viewport" content="initial-scale=1.0, width=device-width" />
  <link href="http://www.unix-lab.org/theme/css/screen.css" rel="stylesheet" type="text/css" />
  <meta name='yandex-verification' content='494a81ecb0e796d6' />
  <link rel="icon" href="http://www.unix-lab.org/favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="http://www.unix-lab.org/favicon.ico" type="image/x-icon">
  <link href="http://www.unix-lab.org/" type="application/atom+xml" rel="alternate" title="unix-lab.org ATOM Feed" />
  <link href="http://www.unix-lab.org/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="unix-lab.org RSS Feed" />
</head>
<body>
<div id="outer-wrapper">
<div id="header-wrapper">
    <a href="http://www.unix-lab.org"><div class="logo"></div></a>
    <div class="small">блог об операционных системах, open source и программировании</div>
<div class="nav">
        <ul>
      <li><a href="http://www.unix-lab.org/archives.html">Архив</a></li>
      <li><a href="http://www.unix-lab.org/about.html">О блоге</a></li>
      <li><a href="http://www.unix-lab.org/authors.html">Экипаж</a></li>
    </ul>
</div>
</div>    <div id="main">
<h2><a href="http://www.unix-lab.org/articles/django-first-steps.html">Django: первые страницы</a></h2>
<h5><i class="icon-feather"></i> 20 Июль 2013 </h5>
<p>Не правда ли, было бы любопытно опробовать знаменитый фреймворк Django для создания сайтов разной степени сложности? Если вам по душе узнавать что-то новое или вы по каким-либо причинам решили отказаться от разработки на PHP — Django как раз то, что вам нужно. В сегодняшнем посте будут оговорены элементарные, но такие необходимые вещи: создание проекта и приложения, модели и отображения, шаблонов с использованием стандартных фильтров. Не исключено, что автор продолжит начатую тему и в последующем будет опубликован ряд постов об этом популярном фреймворке.</p>
<p>Далее предполагается, что у читателя установлен <code>Python3</code> и <code>Django &gt;=1.5</code>: именно на них рассчитаны наши последующие телодвижения. Устанавливать необходимые для конкретного проекта приложения лучше используя <a href="virtualenv.html">virtualenw и pip</a>. Так вы сможете избавить себя от чтения руководств по установке и захламления системных файлов.</p>
<h2>I. Создание проекта и приложения</h2>
<p>Проект — основной каталог, где будут располагаться те или иные приложения, также проект содержит основные настройки будущего сайта. Создадим корневой каталог для проекта и сам проект:</p>
<div class="highlight"><pre><span class="gp">$</span> mkdir djcode <span class="o">&amp;&amp;</span> <span class="nb">cd </span>djcode
<span class="gp">$</span> django-admin.py startproject pySite
</pre></div>


<p>Просмортим появившиеся каталоги:</p>
<div class="highlight"><pre><span class="gp">$</span> tree pySite
<span class="go">pySite</span>
<span class="go">├── manage.py</span>
<span class="go">└── pySite</span>
<span class="go">    ├── __init__.py</span>
<span class="go">    ├── settings.py</span>
<span class="go">    ├── urls.py</span>
<span class="go">    └── wsgi.py</span>
</pre></div>


<p>Вкратце:</p>
<p><code>manage.py</code> — отвечает за управление проектом, например, командой <code>python manage.py runserver</code> можно запустить сервер для тестовой разработки.</p>
<p><code>__init__.py</code> — нужен для того, чтобы python рассматривал каталог <code>pySite</code> как пакет.</p>
<p><code>settings.py</code> — файл настроек проекта: настройки языка, часового пояса, соединения с базой данных, подключаемых приложений и прочего.</p>
<p><code>urls.py</code> — настройки URL-адресов для сайта</p>
<p><code>wsgi.py</code> — конфигурация модуля <code>wsgi</code> для веб-сервера</p>
<p>Хорошо, когда проект расширяемый. Ещё лучше, если его легко сопровождать. Оба этих условия выполняются в Django. Чтобы расширить функционал сайта, следует создать для него какое-либо приложение: галерею, форум, блоги. Затем лишь подключить его в <code>settings.py</code> и подправить свой <code>urls.py</code>, дабы при переходе по определённому адресу пользователь перенаправлялся к страницам приложения. Поэтому давайте создадим какое-нибудь приложение. Пусть оно отвечает за публикацию новостей и хранится в том же каталоге, что и основной проект.</p>
<div class="highlight"><pre><span class="gp">$</span> django-admin.py startapp news
<span class="gp">$</span> tree pySite
<span class="go">pySite</span>
<span class="go">|-- pySite</span>
<span class="go">|   |-- __init__.py</span>
<span class="go">|   |-- settings.py</span>
<span class="go">|   |-- urls.py</span>
<span class="go">|   |-- views.py</span>
<span class="go">|   `-- wsgi.py</span>
<span class="go">|-- manage.py</span>
<span class="go">|-- news</span>
<span class="go">|   |-- admin.py</span>
<span class="go">|   |-- __init__.py</span>
<span class="go">|   |-- models.py</span>
<span class="go">|   |-- tests.py</span>
<span class="go">|   |-- urls.py</span>
<span class="go">|   `-- views.py</span>
</pre></div>


<p>Вкратце:</p>
<p><code>models.py</code> — файл для взаимодействия с базой данных</p>
<p><code>urls.py</code> — отдельный файл url'ов. Он может быть пустым, если вы решите использовать для всех адресов <code>urls.py</code> проекта</p>
<p><code>admin.py</code> — создаётся вручную, нужен исключительно для удобства: настройка отображения моделей в административной панели</p>
<p><code>views.py</code> — самое интересное, управляет логикой приложения</p>
<p>С приложением определились. Отлично! Пора браться за настройки.</p>
<h2>II. Настройки для сайта</h2>
<p>Заглянем в файл <code>settings.py</code> и настроим его под свои скромные пока нужды.</p>
<p><code>PROJECT_PATH</code> — указание на то, где Django нужно искать корень проекта. Лучше использовать запись, приведённую ниже, чем писать полный путь вроде <code>~/home/user/djcode/pySite</code>.</p>
<p><code>DEBUG = True</code> — отладка влючена, Django будет выводить информативные сообщения об ошибках.</p>
<p><code>DATABASES</code> — настройки для вашей базы данных. В примере это <code>sqlite3</code>, который не требует особого к себе отношения, но и полноценной базой данных для сайта на production-сервере быть не может. Чтобы использовать <code>sqlite3</code>, достаточно создать в директории проекта файл <code>sqlite.db</code>. О настройке PostgreSQL <a href="postgresql.html">читаем отдельно</a>.</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">abspath</span><span class="p">,</span> <span class="n">join</span><span class="p">,</span> <span class="n">dirname</span>


<span class="n">PROJECT_PATH</span> <span class="o">=</span> <span class="n">abspath</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">),</span> <span class="s">&#39;..&#39;</span><span class="p">))</span>
<span class="n">DEBUG</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s">&#39;django.db.backends.sqlite3&#39;</span><span class="p">,</span>
        <span class="s">&#39;NAME&#39;</span><span class="p">:</span>  <span class="n">join</span><span class="p">(</span><span class="n">PROJECT_PATH</span><span class="p">,</span> <span class="s">&#39;sqlite.db&#39;</span><span class="p">),</span>
        <span class="s">&#39;USER&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="s">&#39;PASSWORD&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="s">&#39;HOST&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="s">&#39;PORT&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Идём дальше. Желательно сразу создать и подключить директорию, где будет храниться статика: css, javascript и изображения.  Кроме того, нам понадобится директория под наши html-файлы.</p>
<p><code>STATIC_URL</code> — относительный url для статики</p>
<p><code>STATICFILES_DIRS</code> — директория, где расположены соответствующие файлы</p>
<p><code>TEMPLATE_LOADERS</code> — модули для работы с шаблонами</p>
<p><code>TEMPLATE_DIRS</code> — указание на директорию, где лежат html-шаблоны</p>
<p><code>ROOT_URLCONF</code> — главный файл url'ов</p>
<p><code>INSTALLED_APPS</code> — подключенные приложения, вниз добавим наш news.</p>
<div class="highlight"><pre><span class="n">STATIC_URL</span> <span class="o">=</span> <span class="s">&#39;/static/&#39;</span>
<span class="n">STATICFILES_DIRS</span> <span class="o">=</span> <span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">PROJECT_PATH</span><span class="p">,</span> <span class="s">&#39;static&#39;</span><span class="p">),)</span>
<span class="n">TEMPLATE_LOADERS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">&#39;django.template.loaders.filesystem.Loader&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.template.loaders.app_directories.Loader&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">ROOT_URLCONF</span> <span class="o">=</span> <span class="s">&#39;pySite.urls&#39;</span>
<span class="n">TEMPLATE_DIRS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">join</span><span class="p">(</span><span class="n">PROJECT_PATH</span><span class="p">,</span> <span class="s">&#39;templates&#39;</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.sites&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.admin&#39;</span><span class="p">,</span>
    <span class="s">&#39;news&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>


<p>Теперь можно проверить сайт на работоспособность. Для этого, находясь в директории с <code>manage.py</code> следует ввести команду:</p>
<div class="highlight"><pre><span class="gp">$</span> python manage.py syncdb
<span class="gp">$</span> python manage.py runserver
</pre></div>


<p>Первая команда создаст записи в базе данных и предложит создать суперпользователя, если вы подключили приложение административной панели, вторая — запустит тестовый сервер разработки.</p>
<p>По адресу <code>127.0.0.1:8000/</code> должно появиться стандартное окно приветствия Django.</p>
<h2>III. Создание модели и представления, конфигурация <code>urls.py</code></h2>
<p>Следующим шагом будет настройка моделей для взаимодействия с БД, создание представления (логика приложения), настройка файла <code>urls.py</code>.</p>
<p>В примере ниже создаётся класс <code>Post</code>, подкласс абстрактного класса <code>models.Model</code>. Мы хотим видеть у нашего поста название (<code>title</code>), его тело (<code>body</code>), дату создания (<code>timestamp</code>) и автора (<code>author</code>). Обратите внимание на <code>models.*Field</code>. Каждая модель соответствует указанному полю. Так, <code>models.CharField</code> выведет несколько символов, максимальное их значение 150, этого должно хватить для названия; <code>models.TextField</code> позволит вводить неограниченное число символов: полноценный текст; <code>models.ForeignKey</code> указывает на то, что у поста может быть один автор. Эти таблицы будут созданы в базе данных при синхронизации.</p>
<div class="highlight"><pre><span class="c"># ~/djcode/pySite/news/models.py</span>

<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>

<span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span>
</pre></div>


<p>Теперь создадим наше первое представление. Оно призвано выводить список постов на одной странице. О том, как сделать постраничный вывод поговорим <a href="django-pagination.html">в следующий раз</a>.</p>
<div class="highlight"><pre><span class="c"># djcode/pySite/news/views.py</span>

<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">get_object_or_404</span><span class="p">,</span> <span class="n">render_to_response</span>
<span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">RequestContext</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Post</span>


<span class="k">def</span> <span class="nf">news</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Show all news &#39;&#39;&#39;</span>
    <span class="n">posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;-timestamp&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;news/news.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;posts&#39;</span><span class="p">:</span><span class="n">posts</span><span class="p">})</span>
</pre></div>


<p>Совсем не сложно, верно? Это простейшее представление, которое принимает все существующие посты и выводит их на определённой странице. Чуть ниже мы создадим эту страницу. Но сначала наполним сайт каким-нибудь содержимым. Административная панель уже подключена в нашем <code>INSTALLED_APPS</code>, осталось только зайти и проверить как отображаются созданные нами модели. Для отображения их в админке создадим ещё один файл (можно вписать это и в предыдущем файле <code>views</code>, но разделить их иногда удобнее):</p>
<div class="highlight"><pre><span class="c"># djcode/pySite/news/admin.py</span>

<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Post</span>


<span class="k">class</span> <span class="nc">PostAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">models</span> <span class="o">=</span> <span class="n">Post</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="s">&#39;timestamp&#39;</span><span class="p">)</span>
    <span class="n">list_filter</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;timestamp&#39;</span><span class="p">,)</span>


<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Post</span><span class="p">,</span> <span class="n">PostAdmin</span><span class="p">)</span>
</pre></div>


<p>Раскомментируйте в вашем <code>~/djcode/pySite/pySite/urls.py</code> строки</p>
<div class="highlight"><pre><span class="c"># djcode/pySite/pySite/urls.py</span>

<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">include</span><span class="p">,</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="n">admin</span><span class="o">.</span><span class="n">autodiscover</span><span class="p">()</span>


<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^admin/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">)),</span>

<span class="p">)</span>
</pre></div>


<p>После того, как вы зайдёте по адресу <code>127.0.0.1:8000/admin/</code> и создадите несколько постов, вы должны увидеть нечто подобное:</p>
<p><a href="http://farm4.staticflickr.com/3828/9470173657_8ac19b5dab_b.jpg" data-lighter><img src="http://farm4.staticflickr.com/3828/9470173657_8ac19b5dab_b.jpg"/></a></p>
<p>Вернёмся к шаблонам. Вообще, создание страниц мы разделим на два этапа: создание базовой страницы и остальных страниц, которые будут просто наследовать содержимое базового шаблона. Это будет весьма кстати, если только вам не хочется писать каждую страницу с нуля.</p>
<p>Так будет выглядеть шаблон базовой страницы:</p>
<div class="highlight"><pre># djcode/pySite/templates/base.html

{% load static from staticfiles %} <span class="c">&lt;!-- подгружаем статику --&gt;</span>
{% load i18n  %}
<span class="cp">&lt;!DOCTYPE HTML&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
{% block meta %}
<span class="c">&lt;!-- подключаем наш css-файл, если он есть --&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span> <span class="na">href=</span><span class="s">&quot;{% block stylesheet %}{% static &quot;</span><span class="na">css</span><span class="err">/</span><span class="na">base</span><span class="err">.</span><span class="na">css</span><span class="err">&quot;</span> <span class="err">%}{%</span> <span class="na">endblock</span> <span class="err">%}&quot;</span> <span class="nt">/&gt;</span>
{% endblock %}
<span class="nt">&lt;title&gt;</span>{% block title %}My Django Site{% endblock %}<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    {% block header %}
        {% include &quot;header.html&quot; %} <span class="c">&lt;!-- подключаем «шапку» сайта --&gt;</span>
    {% endblock %}
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;content&quot;</span><span class="nt">&gt;</span>
        {% block content %}{% endblock %} <span class="c">&lt;!-- место для контента --&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    {% block footer %} <span class="c">&lt;!-- подключаем «подвал» сайта --&gt;</span>
        {% include &quot;footer.html&quot; %}
    {% endblock %}
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>


<p>Теперь примемся за шаблон, который выведет все наши посты.</p>
<div class="highlight"><pre># djcode/pySite/templates/news/news.html

{% extends &#39;base.html&#39; %} <span class="c">&lt;!-- подключаем базовый шаблон --&gt;</span>
{%block title%}News{%endblock%}
    {% block content %}
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
            {% for post in posts %} <span class="c">&lt;!-- итерация по всем постам --&gt;</span>
                <span class="nt">&lt;ul&gt;</span>
                    <span class="nt">&lt;li&gt;&lt;h3&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;{% url &#39;news:one_new&#39; post.id %}&quot;</span><span class="nt">&gt;</span>{{ post.title }}<span class="nt">&lt;/a&gt;&lt;/h3&gt;&lt;br</span> <span class="nt">/&gt;&lt;/li&gt;&lt;br</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;/ul&gt;</span>
          {{ post.timestamp }} <span class="c">&lt;!-- дата публикации --&gt;</span>
          {{ post.author }} <span class="c">&lt;!-- автор --&gt;</span>
           {{ post.body|truncatewords:80|safe }}<span class="nt">&lt;br</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- обрезаем посты, вывод по 80 слов --&gt;</span>
           <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;{% url &#39;news:one_new&#39; post.id %}&quot;</span><span class="nt">&gt;</span>Читать полностью<span class="ni">&amp;raquo;</span><span class="nt">&lt;/a&gt;</span> <span class="c">&lt;!-- ссылаемся на полный текст поста --&gt;</span>
           {% endfor %}
        <span class="nt">&lt;/div&gt;</span>
    {% endblock %}
</pre></div>


<p>Как уже, должно быть, заметил читатель, мы сразу влючили ссылку на пока несуществующее представление: вывод отдельного поста целиком. Что требуется для его создания? Дальнейшие наши шаги сводятся к созданию ещё одной функции: на этот раз она будет выводить отдельную страницу, подготовки для неё своего шаблона и настройке файла <code>urls.py</code>. Приступим.</p>
<div class="highlight"><pre><span class="c"># djcode/pySite/news/views.py</span>

<span class="c"># после функции news дописать</span>
<span class="k">def</span> <span class="nf">one_new</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">post_id</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Show single news&#39;&#39;&#39;</span>
    <span class="n">post</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Post</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">post_id</span><span class="p">)</span>


    <span class="nb">vars</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="n">post</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
        <span class="n">body</span><span class="o">=</span><span class="n">post</span><span class="o">.</span><span class="n">body</span><span class="p">,</span>
        <span class="n">author</span><span class="o">=</span><span class="n">post</span><span class="o">.</span><span class="n">author</span><span class="p">,</span>
        <span class="n">timestamp</span><span class="o">=</span><span class="n">post</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;news/one_new.html&#39;</span><span class="p">,</span> <span class="nb">vars</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</pre></div>


<p>Переменной post передаётся объект <code>Post</code> с его ID либо вызывается исключение <code>404</code>: страница не найдена. Определяется то, что должно быть выведено: название, автор, время создания. Возвращается страница <code>one_new.html</code>, которой мы сейчас и займёмся.</p>
<div class="highlight"><pre># djcode/pySite/templates/news/one_new.html

{% extends &#39;base.html&#39; %} <span class="c">&lt;!-- подключаем базовый шаблон --&gt;</span>
<span class="c">&lt;!-- отображать название поста как title страницы--&gt;</span>
{% block title %}{{ title }}{% endblock %}
    {% block content %}
    <span class="nt">&lt;b&gt;</span>Дата: {{ timestamp }}<span class="nt">&lt;/b&gt;&lt;br</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;b&gt;</span>Автор: {{ author }}<span class="nt">&lt;/b&gt;&lt;br</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;h1&gt;</span>{{ title }}<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;div&gt;</span>{{ body|safe|escape}}<span class="nt">&lt;/div&gt;</span> <span class="c">&lt;!-- экранировать HTML--&gt;</span>
<span class="c">&lt;!-- escape переводит HTML-теги, если вы использовали их</span>
<span class="c">при написании статьи в админке --&gt;</span>
    {% endblock %}
</pre></div>


<p>Для полного и безоблачного счастья напишем функцию и шаблон для главной страницы, с которой будем переходить на последние десять записей. Не волнуйтесь! Это очень простые операции, хотя если данный пост — первое, что встретилось вам на пути изучения Django, возможно, вы сможете разобраться не с первого чтения... но со второго точно ;)</p>
<p>Итак, представление и шаблон главной страницы:</p>
<div class="highlight"><pre><span class="c"># djcode/pySite/pySite/views.py</span>

<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render_to_response</span>
<span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">RequestContext</span>
<span class="kn">from</span> <span class="nn">news.views</span> <span class="kn">import</span> <span class="n">Post</span>


<span class="c"># можно переписать как в news/views.py</span>
<span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>


    <span class="nb">vars</span> <span class="o">=</span> <span class="nb">dict</span> <span class="p">(</span>
            <span class="n">posts</span><span class="o">=</span><span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;-timestamp&#39;</span><span class="p">)[:</span><span class="mi">10</span><span class="p">],</span>
            <span class="p">)</span>


    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;index.html&#39;</span><span class="p">,</span> <span class="nb">vars</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</pre></div>


<p>Собственно, шаблон для вывода последних десяти публикаций на главной:</p>
<div class="highlight"><pre># djcode/pySite/templates/index.html

{% extends &quot;base.html&quot; %}
{% block title %}Index Page{% endblock %}
    {% block content %}
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;ul&gt;</span>
                {% for post in posts %}
                    <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;{% url &#39;news:one_new&#39; post.id %}&quot;</span><span class="nt">&gt;</span>{{ post.title }}<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
                {% endfor %}
                <span class="nt">&lt;/ul&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    {%endblock%}
</pre></div>


<p>Наконец, создадим два (в примере мы ведь отделяем все приложения друг от друга, чтобы их можно было подключать к другому проекту внесением одной лишь строки в <code>INSTALLED_APPS</code> и синхронизацией с БД) файла <code>urls.py</code>: один главный, другой  — персонально для созданного приложения news. При наличии пяти-десяти приложений это может быть удобным. Если приложение одно и со временем расширять функционал не требуется, создайте лишь один <code>urls.py</code>.</p>
<p>Импортируем необходимые модули, при входе на главную выводим представление, указанное в <code>pySite.views.home</code> функции, при входе на <code>http://127.0.0.1:8000/news</code> перенаправляем поиск в <code>news/urls.py</code>.</p>
<div class="highlight"><pre><span class="c"># djcode/pySite/pySite/urls.py</span>

<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">include</span><span class="p">,</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="n">admin</span><span class="o">.</span><span class="n">autodiscover</span><span class="p">()</span>


<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^$&#39;</span><span class="p">,</span> <span class="s">&#39;pySite.views.home&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;home&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^news/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">&#39;news.urls&#39;</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s">&#39;news&#39;</span><span class="p">)),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^admin/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">)),</span>

<span class="p">)</span>
</pre></div>


<p>В следующем файле обрабатываем наши представления:</p>
<p>если пользователь заходит на страницу вывода всех новостей, использовать функцию <code>news.views.news</code>; если на конкретную новость — вывод выбранной новости из <code>news.views.one_new</code>:</p>
<div class="highlight"><pre><span class="c"># djcode/pySite/news/urls.py</span>

<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">include</span><span class="p">,</span> <span class="n">url</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;news.views&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^$&#39;</span><span class="p">,</span> <span class="s">&#39;news&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;news&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^(?P&lt;post_id&gt;\d+)/$&#39;</span><span class="p">,</span> <span class="s">&#39;one_new&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;one_new&#39;</span><span class="p">),</span>

<span class="p">)</span>
</pre></div>


<p>Дело сделано. Если всё прошло гладко, мы должны прийти примерно к подобному результату:</p>
<p><a href="http://farm6.staticflickr.com/5343/9470178553_84ec6b3262_o.png" data-lighter><img src="http://farm6.staticflickr.com/5343/9470178553_84ec6b3262_o.png"/></a></p>
<p>Успехов в изучении этого отличного фреймворка!</p>
<h5><i class="icon-user"></i> <a href="http://www.unix-lab.org/author/redvi.html">redVi</a>,
<i class="icon-bookmarks"></i> <a href="http://www.unix-lab.org/tag/django.html">Django</a> /
</h5>
<p align="center"><a href="#">наверх</a></p>
</div>
<div id="footer-wrapper">
<ul class="footer">
       <li class="footer"><a href="http://www.unix-lab.org/tag/android.html">Android&nbsp;&bull;&nbsp;</a></li>
       <li class="footer"><a href="http://www.unix-lab.org/tag/arch.html">Arch&nbsp;&bull;&nbsp;</a></li>
       <li class="footer"><a href="http://www.unix-lab.org/tag/blog.html">Blog&nbsp;&bull;&nbsp;</a></li>
       <li class="footer"><a href="http://www.unix-lab.org/tag/debian.html">Debian&nbsp;&bull;&nbsp;</a></li>
       <li class="footer"><a href="http://www.unix-lab.org/tag/decorations.html">Decorations&nbsp;&bull;&nbsp;</a></li>
       <li class="footer"><a href="http://www.unix-lab.org/tag/django.html">Django&nbsp;&bull;&nbsp;</a></li>
       <li class="footer"><a href="http://www.unix-lab.org/tag/editors.html">Editors&nbsp;&bull;&nbsp;</a></li>
       <li class="footer"><a href="http://www.unix-lab.org/tag/gentoo.html">Gentoo&nbsp;&bull;&nbsp;</a></li>
       <li class="footer"><a href="http://www.unix-lab.org/tag/git.html">Git&nbsp;&bull;&nbsp;</a></li>
       <li class="footer"><a href="http://www.unix-lab.org/tag/javascript.html">JavaScript&nbsp;&bull;&nbsp;</a></li>
       <li class="footer"><a href="http://www.unix-lab.org/tag/kernel.html">Kernel&nbsp;&bull;&nbsp;</a></li>
       <li class="footer"><a href="http://www.unix-lab.org/tag/latex.html">LaTeX&nbsp;&bull;&nbsp;</a></li>
       <li class="footer"><a href="http://www.unix-lab.org/tag/python.html">Python&nbsp;&bull;&nbsp;</a></li>
       <li class="footer"><a href="http://www.unix-lab.org/tag/server.html">Server&nbsp;&bull;&nbsp;</a></li>
       <li class="footer"><a href="http://www.unix-lab.org/tag/web.html">Web&nbsp;&bull;&nbsp;</a></li>
       <li class="footer"><a href="http://www.unix-lab.org/tag/windows.html">Windows&nbsp;&bull;&nbsp;</a></li>
  </ul>
<br/><p>&copy;&nbsp;2011&mdash;2013&nbsp;&bull;&nbsp;<a href="http://www.unix-lab.org">unix-lab.org </a>&nbsp;&bull;&nbsp;powered by <a href="https://github.com/getpelican">pelican</a>&nbsp;&bull;&nbsp;<a href="http://creativecommons.org/licenses/by-nc/3.0/deed.ru">CC BY-NC</a></p>
</div>
<!-- end #footer --></div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-42400517-1', 'www.unix-lab.org');
  ga('send', 'pageview');

</script>
</body>
</html>