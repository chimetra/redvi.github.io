<!DOCTYPE html>
<html lang="ru">
<head>
  <title>Установка LAMP в archlinux</title>
  <meta charset="utf-8">
  <meta name="description" content="Apache – это самый популярный веб-сервер. Его задача как и любого другого веб-сервера – отдавать контент на запросы клиентов.">  <meta name="author" content="redVi">  <meta name="viewport" content="initial-scale=1, maximum-scale=1" />
  <link href="../theme/css/screen.css" rel="stylesheet" type="text/css" />
  <meta name='yandex-verification' content='494a81ecb0e796d6' />
  <link rel="icon" href="../favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon">
  <link href="../" type="application/atom+xml" rel="alternate" title="unix-lab.org ATOM Feed" />
  <link href="../feeds/rss.xml" type="application/rss+xml" rel="alternate" title="unix-lab.org RSS Feed" />
</head>
<body>
<div id="outer-wrapper">
<div id="header-wrapper">
    <a href=".."><div class="logo"></div></a>
    <div class="small">блог об операционных системах, open source и программировании</div>
<div class="nav">
        <ul>
      <li><a href="../archives.html">Архив</a></li>
      <li><a href="../about.html">О блоге</a></li>
      <li><a href="../authors.html">Экипаж</a></li>
    </ul>
</div>
</div>    <div id="main">
<h2><a href="../articles/lamp.html">Установка LAMP в archlinux</a></h2>
<h5><i class="icon-feather"></i> 21 Январь 2012 </h5>
<p>Apache &mdash; это самый популярный веб-сервер. Его задача как и любого другого
веб-сервера &mdash; отдавать контент на запросы клиентов. Apache обладает
большим функционалом за счет подключаемых модулей.</p>
<h2>Установка</h2>
<div class="highlight"><pre><span class="gp">$</span> sudo pacman -S apache php php-apache mysql
</pre></div>


<p>Это наиболее популярный вариант установки. Таким образом мы получим небезызвестный LAMP &mdash; Linux + Apache + MySQL + PHP</p>
<p>Если вы не нуждаетесь в каком-либо из компонентов, не ставьте его.</p>
<p>Не забудьте установить пароль для пользователя MySQL. Для этого необходимо запустить сервер командой <code>/etc/rc.d/httpd start</code>, а затем выполнить следующее:</p>
<div class="highlight"><pre><span class="gp">$</span> /usr/bin/mysqladmin -u root password новый_пароль
<span class="gp">$</span> /usr/bin/mysqladmin -u root -h linux password новый_пароль
</pre></div>


<p>Теперь если вы попробуете зайти без пароля, у вас ничего не выйдет:</p>
<div class="highlight"><pre><span class="gp">$</span> sudo mysql -u root
<span class="go">ERROR 1045 (28000): Access denied for user &#39;root&#39;@&#39;localhost&#39; (using password: NO)</span>
</pre></div>


<p>Входим с паролем:</p>
<div class="highlight"><pre><span class="gp">$</span>sudo mysql -u root -p
</pre></div>


<p>В ответ на это вам предложат ввести заданный пароль.</p>
<p>Можете воспользоваться альтернативным методом, запустив:</p>
<div class="highlight"><pre><span class="gp">$</span> /usr/bin/mysql_secure_installation
</pre></div>


<p>Теперь проверим, есть ли в <code>/etc/shadow</code> пользователь <code>http</code>:</p>
<div class="highlight"><pre><span class="gp">#</span> cat /etc/shadow :
<span class="go">http:x:14871::::::</span>
</pre></div>


<p>Если такой строки вами найдено не было, добавляем пользователя вручную:</p>
<div class="highlight"><pre><span class="gp">#</span> useradd -d /srv/http -r -s /bin/false -U http
</pre></div>


<p>Смотрим содержание нашего <code>/etc/hosts</code>:</p>
<div class="highlight"><pre><span class="c"># /etc/hosts: static lookup table for host names</span>
<span class="c">#</span>
<span class="c">#&lt;ip-address&gt; &lt;hostname.domain.org&gt; &lt;hostname&gt;</span>
127.0.0.1 localhost.localdomain localhost linux
</pre></div>


<p>Примечание: здесь и далее <code>linux</code> - имя хоста, т.е. вашей машины</p>
<p>Так должен выглядеть <code>/etc/rc.conf</code>:</p>
<div class="highlight"><pre><span class="cp"># --------------------------------------</span>
<span class="cp"># NETWORKING</span>
<span class="cp"># --------------------------------------</span>
<span class="cp">#</span>
<span class="cp"># HOSTNAME: Hostname of machine. Should also be put in /etc/hosts</span>
<span class="cp">#</span>
<span class="n">HOSTNAME</span><span class="o">=</span><span class="s">&quot;linux&quot;</span>
</pre></div>


<p>Итак, если вы ещё не запустили Apache, пришло время сделать это:</p>
<div class="highlight"><pre><span class="gp">#</span> /etc/rc.d/httpd start
</pre></div>


<p>Проверим его работоспособность, пройдя по ссылке в браузере: <code>http://localhost/</code>
Если всё нормально, вы увидите следующее изображение:</p>
<p><img alt="localhost" src="http://3.bp.blogspot.com/-wrcyniFvt0o/TwBDrvF4tfI/AAAAAAAAAeU/jQuqE1PbVbw/s1600/apache2.png" /></p>
<p>Если веб-сервер не запустился, тестируем настройку:</p>
<div class="highlight"><pre><span class="gp">#</span> apachectl configtest
</pre></div>


<h2>Что делать с PHP?</h2>
<p>Добавьте  в <code>/etc/httpd/conf/httpd.conf</code>  в секцию <code>DefaultType text/plain</code>:</p>
<div class="highlight"><pre><span class="n">LoadModule</span> <span class="n">php5_module</span> <span class="n">modules</span><span class="o">/</span><span class="n">libphp5</span><span class="p">.</span><span class="n">so</span>
<span class="n">Include</span> <span class="n">conf</span><span class="o">/</span><span class="n">extra</span><span class="o">/</span><span class="n">php5_module</span><span class="p">.</span><span class="n">conf</span>
</pre></div>


<p>Для того чтобы обрабатывались <code>*.php</code> файлы:</p>
<div class="highlight"><pre><span class="n">AddType</span> <span class="n">application</span><span class="o">/</span><span class="n">x</span><span class="o">-</span><span class="n">httpd</span><span class="o">-</span><span class="n">php</span> <span class="p">.</span><span class="n">php</span>
<span class="n">AddType</span> <span class="n">application</span><span class="o">/</span><span class="n">x</span><span class="o">-</span><span class="n">httpd</span><span class="o">-</span><span class="n">php</span><span class="o">-</span><span class="n">source</span> <span class="p">.</span><span class="n">phps</span>
</pre></div>


<p>Чтобы  php код обрабатывался в файлах <code>*.html</code>:</p>
<div class="highlight"><pre><span class="n">AddType</span> <span class="n">application</span><span class="o">/</span><span class="n">x</span><span class="o">-</span><span class="n">httpd</span><span class="o">-</span><span class="n">php</span> <span class="p">.</span><span class="n">html</span>
<span class="n">AddType</span> <span class="n">application</span><span class="o">/</span><span class="n">x</span><span class="o">-</span><span class="n">httpd</span><span class="o">-</span><span class="n">php</span> <span class="p">.</span><span class="n">htm</span>
</pre></div>


<p>После чего понадобится перезапустить веб-сервер:</p>
<div class="highlight"><pre><span class="gp">#</span> /etc/rc.d/httpd restart
</pre></div>


<p>Посмотреть корневую директорию сервера можно в этом же файле. Выглядит так:</p>
<div class="highlight"><pre><span class="n">DocumentRoot</span> <span class="s">&quot;/srv/http&quot;</span>
</pre></div>


<p>Здесь же можно затронуть файл <code>/etc/php/php.ini</code>:</p>
<p>Нам важно знать путь к корневой директории. По умолчанию нужная строка выглядит так:</p>
<div class="highlight"><pre><span class="n">open_basedir</span> <span class="o">=</span> <span class="o">/</span><span class="n">srv</span><span class="o">/</span><span class="n">http</span><span class="o">/:/</span><span class="n">home</span><span class="o">/:/</span><span class="n">tmp</span><span class="o">/:/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">pear</span><span class="o">/</span>
</pre></div>


<p>Что ж, теперь проверим отображение php-файлов. Пишем простую страничку примерно такого содержания:</p>
<div class="highlight"><pre><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;title&gt;</span>PHP<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>

<span class="nt">&lt;body&gt;</span>
My test page
<span class="cp">&lt;?php</span>
<span class="cp">  phpinfo();</span>
<span class="cp">?&gt;</span>
<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>


<p>Так, в заголовке должно быть отображено название документа - PHP, в теле текст "My test page" и, если работает php, при помощи функции <code>phpinfo()</code> будет выведена его служебная информация.</p>
<p>Сохраните этот документ под именем <code>page.php</code> и сохраните в <code>/srv/http/</code> , то есть в корневую директорию сервера. Разумеется, у вас могут быть свои настройки. Чтобы протестировать следует зайти на страницу:</p>
<div class="highlight"><pre><span class="nl">http:</span><span class="c1">//localhost/page.php</span>
</pre></div>


<p>Вот что вы должны увидеть:</p>
<p><img alt="php" src="http://3.bp.blogspot.com/-vHPxeFERVbY/TwGCCASgxxI/AAAAAAAAAeg/sGxJERM4BAo/s1600/apache_php.png" /></p>
<h2>MySQL</h2>
<p>Для поддержки MySQL в  <code>/etc/php/php.ini</code>  раскомментируйте следующие строку:</p>
<div class="highlight"><pre><span class="p">;</span><span class="n">extension</span><span class="o">=</span><span class="n">mysql</span><span class="p">.</span><span class="n">so</span>
</pre></div>


<p>Для настройки вашей системы выполните <code>/etc/rc.d/mysqld start</code>.</p>
<p>Убедитесь, что группа и пользователь <code>mysql</code> существуют. Если нет, добавьте их вручную:</p>
<div class="highlight"><pre><span class="gp">#</span> groupadd -g 89 mysql
<span class="gp">#</span> useradd -u 89 -g mysql -d /var/lib/mysql -s /bin/false mysql
</pre></div>


<p>Измените владельца корневой директории MYSQL:</p>
<div class="highlight"><pre><span class="gp">#</span> chown -R mysql:mysql /var/lib/mysql
</pre></div>


<h3>Установка базы данных</h3>
<p>Если вы хотите запускать mysql от имени суперпользователя, можете не применять опцию <code>--user</code> и не изменять владельца</p>
<div class="highlight"><pre><span class="gp">#</span> mysql_install_db --datadir<span class="o">=</span>/var/lib/mysql --user<span class="o">=</span>mysql
<span class="gp">#</span> chown -R mysql:mysql /var/lib/mysql
</pre></div>


<p>Для запуска MySQL:</p>
<div class="highlight"><pre><span class="gp">#</span> /etc/rc.d/mysqld start
</pre></div>


<p>Тестируем mysql (как root):</p>
<div class="highlight"><pre><span class="gp">#</span> mysql
</pre></div>


<p>Задать пароль для mysql :</p>
<div class="highlight"><pre><span class="gp">#</span> mysqladmin -u root password <span class="s1">&#39;пароль_root&#39;</span>
</pre></div>


<p>Для входа в mysql:</p>
<div class="highlight"><pre><span class="gp">#</span> mysql -u root -h linux -p
</pre></div>


<p>где linux - не забывайте! - имя вашего хоста.</p>
<h2>Установка phpMyAdmin (не бязательно)</h2>
<p>Следует установить нужные пакеты:</p>
<div class="highlight"><pre><span class="go"> $ sudo pacman -S php-mcrypt phpmyadmin</span>
</pre></div>


<p>И исправить несколько файлов как указано ниже.</p>
<div class="highlight"><pre><span class="gp">$</span> sudo rm -r /srv/http/phpMyAdmin - в случае, если phpmyadmin уже был установлен ранее
<span class="gp">$</span> sudo cp /etc/webapps/phpmyadmin/apache.example.conf /etc/httpd/conf/extra/httpd-phpmyadmin.conf - скопируем <span class="s2">&quot;образцовый&quot;</span> файл настроек
</pre></div>


<p>Отредактируем файлы <code>/etc/httpd/conf/httpd.conf</code> и <code>/etc/webapps/phpmyadmin/.htaccess</code></p>
<div class="highlight"><pre><span class="c"># httpd.conf</span>
<span class="c">#</span>
<span class="c"># phpMyAdmin configuration</span>
Include conf/extra/httpd-phpmyadmin.conf

<span class="c"># /etc/webapps/phpmyadmin/.htaccess</span>
<span class="c"># deny from all</span>
</pre></div>


<p>Теперь, перезагрузив наш <code>httpd</code>, можно войти в <code>phpmyadmin</code> по адресу <code>http://localhost/phpmyadmin</code>:</p>
<p><img alt="phpmyadmin" src="http://4.bp.blogspot.com/-iWb_bAkGXQE/T0SrxOEJbFI/AAAAAAAAAik/N70gh7PPzhk/s1600/phpmyadmin.png" /></p>
<p>Примечание: для запуска Apache и MySQL при старте системы, добавьте в <code>/etc/rc.conf</code> в секцию <code>DAMONS</code> соответствующие службы, вот так:</p>
<div class="highlight"><pre><span class="n">DAEMONS</span><span class="o">=</span><span class="p">(......</span> <span class="n">httpd</span> <span class="n">mysqld</span><span class="p">)</span>
</pre></div>
<h5><i class="icon-user"></i> <a href="../author/redvi.html">redVi</a>,
<i class="icon-bookmarks"></i> <a href="../tag/arch.html">Arch</a> /
<a href="../tag/server.html">Server</a> /
</h5>
<p align="center"><a href="#">наверх</a></p>
</div>
<div id="footer-wrapper">
<ul class="footer">
       <li class="footer"><a href="../tag/android.html">Android&nbsp;&bull;&nbsp;</a></li>
       <li class="footer"><a href="../tag/arch.html">Arch&nbsp;&bull;&nbsp;</a></li>
       <li class="footer"><a href="../tag/blog.html">Blog&nbsp;&bull;&nbsp;</a></li>
       <li class="footer"><a href="../tag/debian.html">Debian&nbsp;&bull;&nbsp;</a></li>
       <li class="footer"><a href="../tag/decorations.html">Decorations&nbsp;&bull;&nbsp;</a></li>
       <li class="footer"><a href="../tag/django.html">Django&nbsp;&bull;&nbsp;</a></li>
       <li class="footer"><a href="../tag/editors.html">Editors&nbsp;&bull;&nbsp;</a></li>
       <li class="footer"><a href="../tag/gentoo.html">Gentoo&nbsp;&bull;&nbsp;</a></li>
       <li class="footer"><a href="../tag/git.html">Git&nbsp;&bull;&nbsp;</a></li>
       <li class="footer"><a href="../tag/javascript.html">JavaScript&nbsp;&bull;&nbsp;</a></li>
       <li class="footer"><a href="../tag/kernel.html">Kernel&nbsp;&bull;&nbsp;</a></li>
       <li class="footer"><a href="../tag/latex.html">LaTeX&nbsp;&bull;&nbsp;</a></li>
       <li class="footer"><a href="../tag/python.html">Python&nbsp;&bull;&nbsp;</a></li>
       <li class="footer"><a href="../tag/server.html">Server&nbsp;&bull;&nbsp;</a></li>
       <li class="footer"><a href="../tag/web.html">Web&nbsp;&bull;&nbsp;</a></li>
       <li class="footer"><a href="../tag/windows.html">Windows&nbsp;&bull;&nbsp;</a></li>
  </ul>
<br/><p>&copy;&nbsp;2011&mdash;2013&nbsp;&bull;&nbsp;<a href="..">unix-lab.org </a>&nbsp;&bull;&nbsp;powered by <a href="https://github.com/getpelican">pelican</a>&nbsp;&bull;&nbsp;<a href="http://creativecommons.org/licenses/by-nc/3.0/deed.ru"><i class="icon-cc"></i></a></p>
</div>
<!-- end #footer --></div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-42400517-1', 'www.unix-lab.org');
  ga('send', 'pageview');

</script>
</body>
</html>