<!DOCTYPE html>
<html lang="ru">
<head>

  <title>Arch Linux. Тонкая настройка | UNIX-LAB.ORG</title>
  <meta name="description" content="В продолжение статьи об установке лёгкого, быстрого и простого дистрибутива.">

  <meta charset="utf-8">
  <meta name="author" content="redVi">
  <meta name="viewport" content="initial-scale=1.0, width=device-width" />
  <link rel="icon" href="http://www.unix-lab.org/favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="http://www.unix-lab.org/favicon.ico" type="image/x-icon">
  <link href="http://www.unix-lab.org/assets/stylesheets/screen.css" rel="stylesheet" type="text/css" />
  <link rel="alternate" type="application/atom+xml" title="UNIX-LAB.ORG" href="http://www.unix-lab.org/feeds/atom.xml">
  <link rel="alternate" type="application/rss+xml" title="UNIX-LAB.ORG" href="http://www.unix-lab.org/feeds/rss.xml">
</head>
<body>
<div id="outer-wrapper">
<div id="header-wrapper">
    <a href="/"><div class="logo"></div></a>
    <div class="small">блог об операционных системах, open source и программировании</div>
<div class="nav">
  <ul>
    <li><a href="/archive/">Архив</a></li>
    <li><a href="/about/">О блоге</a></li>
    <li><a href="/author/">Автор</a></li>
  </ul>
</div>
</div>

<div id="main">
<h2>Arch Linux. Тонкая настройка</h2>
<h5><i class="icon-feather"></i> 19 октября 2011

 <i class="icon-bookmarks"></i>

<a href="/tags/arch.html">Arch /</a>

<a href="/tags/linux.html">Linux /</a>

</h5>

<p>В продолжение статьи <a href="http://www.unix-lab.org/posts/arch-install/">об установке лёгкого, быстрого и простого дистрибутива</a>. В конце поста небольшой видеоролик с установкой LXDE. Не красоты ради, а удобства для. Чтобы вам не приходилось настраивать свой арч, сидя в консоли.</p>

<p>В общем и целом настройка arhclinux будет сведена к нескольким несложным действиям как то:</p>

<ul>
<li><a href="#inet">Настройка интернет-соединения</a></li>
<li><a href="#xorg">Установка драйверов на видео + xorg</a></li>
<li><a href="#environ">Установка окружения рабочего стола</a></li>
<li><a href="#touchpad">Настройка тачпада</a></li>
<li><a href="#switcheroo">Переключение графики при наличии двух видеокарт</a></li>
<li><a href="#powersave">Энергосбережение</a></li>
<li><a href="#fn">fn-клавиши</a></li>
</ul>

<h3 id="toc_0"><a id="inet"></a>Настройка интернет-соединения</h3>

<p>Примеры конфигураций можно посмотреть по адресу <code>/etc/network.d/examples/</code></p>

<p><img src="http://2.bp.blogspot.com/-TaIchwvehBE/UEWDUk5IDCI/AAAAAAAABXU/DdPLyq9ELCU/s1600/eth1.png" alt="net"></p>

<p>Достаточно выбрать своё подключение и скопировать соответствующий файл в <code>/etc/network.d/</code> наименование_вашего_профиля. Например:</p>
<div class="highlight"><pre><code class="console language-console" data-lang="console"><span class="gp">#</span> cp /etc/network.d/examples/ethernet-static /etc/network.d/eth0
</code></pre></div>
<p>Открыть скопированный файл в любимом текстовом редакторе и исправить значения на свои:</p>

<p><img src="http://2.bp.blogspot.com/-TfEoJZbPRHs/UEWEM3A9k_I/AAAAAAAABXc/Mijq913elto/s1600/eth0.png" alt="static"></p>

<p>После чего запустить профиль командой:</p>
<div class="highlight"><pre><code class="console language-console" data-lang="console"><span class="gp">#</span> netcfg eth0 up
</code></pre></div>
<h3 id="toc_1"><a id="xorg"></a>Установка драйверов на видео + xorg</h3>

<p>Посмотрим на свою видеокарту:</p>
<div class="highlight"><pre><code class="console language-console" data-lang="console"><span class="gp">$</span> lspci | grep VGA
</code></pre></div>
<p>или</p>
<div class="highlight"><pre><code class="console language-console" data-lang="console"><span class="gp">$</span> lspci | grep -i vga
</code></pre></div>
<p>Найдём нужный (в примере открытый для карты intel!) драйвер:</p>
<div class="highlight"><pre><code class="console language-console" data-lang="console"><span class="gp">#</span> pacman -Ss xf86-video-intel | less
</code></pre></div>
<p>Установим необходимые пакеты:</p>
<div class="highlight"><pre><code class="console language-console" data-lang="console"><span class="gp">#</span> pacman -S xf86-video-intel
<span class="gp">#</span> pacman -S xorg-server xorg-xinit xorg-utils xorg-server-utils mesa mesa-demos
</code></pre></div>
<p>Дайте команду <code>startx</code>. Если всё в порядке, вы увидите псевдографические окна. Если нет:</p>

<p>пробуем запустить графику с драйвером <code>vesa</code>:</p>
<div class="highlight"><pre><code class="console language-console" data-lang="console"><span class="gp">#</span> pacman -S xf86-video-vesa
</code></pre></div>
<p>конфигурируем xorg:</p>
<div class="highlight"><pre><code class="console language-console" data-lang="console"><span class="gp">#</span> Xorg -configure
</code></pre></div>
<p>Файл конфигурации появится в каталоге <code>/root</code> и будет носить название <code>xorg.conf.new</code>. отредактируйте его, если нужно, и скопируйте в каталог <code>/etc/X11</code>:</p>
<div class="highlight"><pre><code class="console language-console" data-lang="console"><span class="gp">#</span> cp xorg.conf.new /etc/X11/xorg.conf
</code></pre></div>
<p>Стартуйте графику снова.</p>

<h3 id="toc_2"><a id="environ"></a>Установка окружения рабочего стола:</h3>
<div class="highlight"><pre><code class="console language-console" data-lang="console"><span class="gp">#</span> pacman -S lxde
</code></pre></div>
<p><b>Примечание:</b> lxde лишь один из возможных вариантов и приводится как пример</p>

<p>Стартуем:</p>
<div class="highlight"><pre><code class="console language-console" data-lang="console"><span class="gp">$</span> sudo /user/sbin/lxdm start
</code></pre></div>
<p>Теперь вы увидите обычный рабочий стол с окружением lxde. Чтобы запускать графику при старте системы следует дописать в <code>/etc/rc.conf</code> в секцию <code>DAEMONS</code> - lxde.</p>

<h3 id="toc_3"><a id="touchpad"></a>Настройка тачпада (если есть):</h3>
<div class="highlight"><pre><code class="console language-console" data-lang="console"><span class="gp">#</span> pacman -S xf86-input-synaptics
</code></pre></div>
<p>Создаём в <code>/etc/X11/xorg.conf.d/</code> новый файл с именем <code>50-synaptics.conf</code>:</p>
<div class="highlight"><pre><code class="sh language-sh" data-lang="sh">Section <span class="s2">&quot;InputClass&quot;</span>
    Identifier <span class="s2">&quot;touchpad&quot;</span>
    Driver <span class="s2">&quot;synaptics&quot;</span>
    MatchIsTouchpad <span class="s2">&quot;on&quot;</span>
    Option <span class="s2">&quot;SHMConfig&quot;</span> <span class="s2">&quot;on&quot;</span>
    Option <span class="s2">&quot;TapButton1&quot;</span> <span class="s2">&quot;1&quot;</span>
    Option <span class="s2">&quot;TapButton2&quot;</span> <span class="s2">&quot;2&quot;</span>
    Option <span class="s2">&quot;TapButton3&quot;</span> <span class="s2">&quot;3&quot;</span>
    Option <span class="s2">&quot;VertEdgeScroll&quot;</span> <span class="s2">&quot;on&quot;</span>
    Option <span class="s2">&quot;VertTwoFingerScroll&quot;</span> <span class="s2">&quot;on&quot;</span>
    Option <span class="s2">&quot;HorizEdgeScroll&quot;</span> <span class="s2">&quot;on&quot;</span>
    Option <span class="s2">&quot;HorizTwoFingerScroll&quot;</span> <span class="s2">&quot;on&quot;</span>
    Option <span class="s2">&quot;CircularScrolling&quot;</span> <span class="s2">&quot;on&quot;</span>
    Option <span class="s2">&quot;CircScrollTrigger&quot;</span> <span class="s2">&quot;2&quot;</span>
    Option <span class="s2">&quot;EmulateTwoFingerMinZ&quot;</span> <span class="s2">&quot;0&quot;</span>
EndSection
</code></pre></div>
<h3 id="toc_4"><a id="switcheroo"></a>Переключение графики при наличии двух видеокарт:</h3>

<p>Подмонтируем <code>gebug</code>:</p>
<div class="highlight"><pre><code class="console language-console" data-lang="console"><span class="gp">#</span> mount -t debugfs /sys/kernel/debug
<span class="gp">#</span> vim /etc/fstab:
<span class="go">debugfs /sys/kernel/debug   debugfs defaults    0   0</span>
<span class="gp">#</span> modprobe radeon
</code></pre></div>
<p>Перезагрузка</p>

<p>Проверьте поддержку <code>vgaswitcheroo</code> в ядре:</p>
<div class="highlight"><pre><code class="console language-console" data-lang="console"><span class="gp">$</span> cat /sys/kernel/debug/vgaswitcheroo/switch
</code></pre></div>
<p>или, если каталога и файла <code>vgaswitheroo/switch</code> ещё нет:</p>
<div class="highlight"><pre><code class="console language-console" data-lang="console"><span class="gp">$</span> gzip -cd /proc/config.gz | grep SWITCHEROO
<span class="go">WGASWITCHEROO=y</span>
</code></pre></div>
<p>Такое выдало? Отлично, всё включено. Нет? Идите и <a href="http://www.unix-lab.org/posts/kernel-v3/">компилируйте ядро с поддержкой vgaswitcheroo</a>.</p>

<p>Активировать ATI:</p>
<div class="highlight"><pre><code class="console language-console" data-lang="console"><span class="gp">#</span> <span class="nb">echo </span>DDIS &gt; /sys/kernel/debug/vgaswitcheroo/switch
</code></pre></div>
<p>Активировать Intel:</p>
<div class="highlight"><pre><code class="console language-console" data-lang="console"><span class="gp">#</span> <span class="nb">echo </span>DIGD &gt; /sys/kernel/debug/vgaswitcheroo/switch
</code></pre></div>
<p>Отключить неиспользуемую видеокарту:</p>
<div class="highlight"><pre><code class="console language-console" data-lang="console"><span class="gp">#</span> <span class="nb">echo </span>OFF &gt; /sys/kernel/debug/vgaswitcheroo/switch
</code></pre></div>
<p>Включить неиспользуемую видеокарту:</p>
<div class="highlight"><pre><code class="console language-console" data-lang="console"><span class="gp">#</span> <span class="nb">echo </span>ON &gt; /sys/kernel/debug/vgaswitcheroo/switch
</code></pre></div>
<p>Если чувствуете, что карта не отключилась:</p>
<div class="highlight"><pre><code class="console language-console" data-lang="console"><span class="gp">#</span> <span class="nb">echo</span> <span class="s2">&quot;blacklist radeon&quot;</span> &gt;&gt; /etc/modprobe.d/modprobe.conf
</code></pre></div>
<p>Если нужно, чтобы карта не включалась при загрузке системы, допишите в <code>/etc/rc.locale</code>:</p>
<div class="highlight"><pre><code class="sh language-sh" data-lang="sh"><span class="c"># chown &quot;username&quot; /sys/kernel/debug/vgaswitcheroo/switch</span>
<span class="c"># где &quot;username&quot; имя вашего пользователя</span>
<span class="c"># echo OFF &gt; /sys/kernel/debug/vgaswitcheroo/switch</span>
</code></pre></div>
<p><img src="http://1.bp.blogspot.com/-z3wugAFhedo/UEWFsj5DhRI/AAAAAAAABXk/SOy5k-PNDts/s1600/echo_off.png" alt="off"></p>

<h3 id="toc_5"><a id="powersave"></a>Энергосбережение</h3>

<p>Не буду повторять многократно пересказанное. Вики вам в помощь, дамы и господа:</p>

<ul>
<li><a href="http://www.unix-lab.org/posts/acpi/">acpi</a></li>
<li><a href="https://wiki.archlinux.org/index.php/Laptop_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)">laptop</a></li>
<li><a href="https://wiki.archlinux.org/index.php/Lm_sensors_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)">lm sensors</a></li>
</ul>

<p>Для автоматического старта <code>laptop-mode</code>:</p>
<div class="highlight"><pre><code class="console language-console" data-lang="console"><span class="gp">#</span> systemctl <span class="nb">enable </span>laptop-mode.service
</code></pre></div>
<h3 id="toc_6"><a id="fn"></a>Горячие клавиши, fn-клавиши ноутбука</h3>

<p>В KDE изначально не было возможности регулировать яркость экрана, что, впрочем, быстро пофиксилось добавлением лишь одной строки к загрузчику. Зато Gnome 3 приятно удивил, подхватив и кнопки управления яркостью дисплея, и кнопки увеличения громкости звука, и даже включение bluetooth, так что... хотите работу &quot;из коробки&quot; &mdash; добро пожаловать в Gnome.</p>

<p><u>KDE</u>
<a href="http://farm3.staticflickr.com/2812/9471540916_d9ffb37430_b.jpg" data-lighter><img src="http://farm3.staticflickr.com/2812/9471540916_d9ffb37430_b.jpg"/></a></p>

<p><u>Gnome</u>
<a href="http://farm6.staticflickr.com/5322/9468762349_c9cfdfa125_b.jpg" data-lighter><img src="http://farm6.staticflickr.com/5322/9468762349_c9cfdfa125_b.jpg"/></a></p>

<p>Для любителей минимализма осмелюсь порекомендовать <a href="http://www.unix-lab.org/posts/openbox/">openbox</a> или же <a href="http://www.unix-lab.org/posts/xmonad/">xmonad</a>.</p>

<p><b>ВНИМАНИЕ!</b> Поскольку с недавнего времени archlinux претерпел некоторые изменения, а именно осуществился переход к <code>systemd</code>, файл <code>/etc/rc.conf</code>, скорее всего, скоро перестанет поддерживаться, хотя на данный момент такая возможность есть. Вместо этого пишутся юниты для автозапуска тех или иных сервисов. Так, юнит запуска KDM выглядит следующим образом:</p>

<p><img src="http://2.bp.blogspot.com/---9N3-j3xxw/UEWGh2MgKKI/AAAAAAAABXs/cUMEfN5QPN0/s1600/systemd_unit.png" alt="systemd"></p>

<p>Для того, чтобы KDM стартовал при загрузке системы, выполните команду:</p>
<div class="highlight"><pre><code class="console language-console" data-lang="console"><span class="gp">#</span> systemctl <span class="nb">enable </span>kdm.service
</code></pre></div>
<p>Запуск <code>rc.local</code> больше не требуется. Вместо этого создадим юнит с нужной командой (в примере: отключение внешней видео карты)</p>
<div class="highlight"><pre><code class="sh language-sh" data-lang="sh"><span class="c"># /etc/systemd/system/rc-local.service</span>
<span class="c">#</span>
<span class="o">[</span>Unit<span class="o">]</span>
<span class="nv">Description</span><span class="o">=</span>/etc/rc.local
Compatibility <span class="o">[</span>Service<span class="o">]</span>
<span class="nv">Type</span><span class="o">=</span>oneshot
<span class="nv">ExecStart</span><span class="o">=</span>/bin/sh -c <span class="s1">&#39;echo OFF &gt; /sys/kernel/debug/vgaswitcheroo/switch&#39;</span>
<span class="nv">RemainAfterExit</span><span class="o">=</span>yes
<span class="o">[</span>Install<span class="o">]</span>
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</code></pre></div>
<p>Для запуска iptables при старте системы</p>
<div class="highlight"><pre><code class="sh language-sh" data-lang="sh"><span class="c"># /etc/systemd/system/iptables.service</span>
<span class="c">#</span>
<span class="o">[</span>Unit<span class="o">]</span>
<span class="nv">Description</span><span class="o">=</span>Start iptables
<span class="o">[</span>Service<span class="o">]</span> <span class="nv">ExecStart</span><span class="o">=</span>/usr/sbin/iptables
<span class="o">[</span>Install<span class="o">]</span> <span class="nv">Before</span><span class="o">=</span>network.target
</code></pre></div>
<p>Добавление в автозапуск осуществляется командами <code>systemctl enable rc-local.service</code>
и <code>systemctl enable iptables.service</code> соответственно.</p>

<p>Тема юнитов <code>systemd</code> достаточно объёмна и заслуживает отдельного рассмотрения. Подробнее <a href="https://wiki.archlinux.org/index.php/Systemd">здесь</a>.</p>

<p>Модули ядра теперь живут по адресу: <code>/etc/modules-load.d/</code></p>

<p>Так, чтобы при старте системы загружались необходимые модули, мы можем создать файл с расширением <code>.conf</code> и вписать их туда. Например:</p>
<div class="highlight"><pre><code class="sh language-sh" data-lang="sh"><span class="c"># /etc/modules-load.d/load_modules.conf</span>
<span class="c">#</span>
acpi-cpufreq cpufreq_conservative
</code></pre></div>
<p>Удачи!</p>

<div class="video"><iframe width="400" height="300" src="http://www.youtube.com/embed/2EIo6-bH9DU?rel=0" frameborder="0" allowfullscreen></iframe></div>


<br />
<p align="center"><a href="#">наверх</a></p>


</div>
</div>
<div id="footer-wrapper">
<ul class="footer">
   <a href="/tags/android.html" class="set-1">android</a> <a href="/tags/arch.html" class="set-3">arch</a> <a href="/tags/blog.html" class="set-1">blog</a> <a href="/tags/debian.html" class="set-1">debian</a> <a href="/tags/decorations.html" class="set-1">decorations</a> <a href="/tags/editors.html" class="set-1">editors</a> <a href="/tags/gentoo.html" class="set-1">gentoo</a> <a href="/tags/git.html" class="set-1">git</a> <a href="/tags/kernel.html" class="set-1">kernel</a> <a href="/tags/latex.html" class="set-1">latex</a> <a href="/tags/linux.html" class="set-5">linux</a> <a href="/tags/python.html" class="set-2">python</a> <a href="/tags/ruby.html" class="set-1">ruby</a> <a href="/tags/server.html" class="set-2">server</a> <a href="/tags/web.html" class="set-1">web</a> <a href="/tags/windows.html" class="set-1">windows</a>
</ul>
<ul class="footer">
    <li class="footer">&copy;&nbsp;2011&mdash;2013&nbsp;::</li>
    <li class="footer"><a href="/">unix-lab.org</a>&nbsp;::</li>
    <li class="footer">licensed under <a href="http://creativecommons.org/licenses/by-nc/3.0/deed.ru">CC BY-NC</a></li>
</ul>
</div>

</body>
</html>
