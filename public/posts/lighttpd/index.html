<!DOCTYPE html>
<html lang="ru">
<head>

  <title>Lighttpd: лёгкий веб-сервер для личных нужд | UNIX-LAB.ORG</title>
  <meta name="description" content="Пример установки lighttpd и настройки wordpress.">

  <meta charset="utf-8">
  <meta name="author" content="redVi">
  <meta name='yandex-verification' content='494a81ecb0e796d6' />
  <meta name="viewport" content="initial-scale=1.0, width=device-width" />
  <link rel="icon" href="http://www.unix-lab.org/favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="http://www.unix-lab.org/favicon.ico" type="image/x-icon">
  <link href="http://www.unix-lab.org/assets/stylesheets/screen.css" rel="stylesheet" type="text/css" />
  <link rel="alternate" type="application/atom+xml" title="UNIX-LAB.ORG" href="http://www.unix-lab.org/feeds/atom.xml">
  <link rel="alternate" type="application/rss+xml" title="UNIX-LAB.ORG" href="http://www.unix-lab.org/feeds/rss.xml">
</head>
<body>
<div id="outer-wrapper">
<div id="header-wrapper">
    <a href="/"><div class="logo"></div></a>
    <div class="small">блог об операционных системах, open source и программировании</div>
<div class="nav">
  <ul>
    <li><a href="/archive/">Архив</a></li>
    <li><a href="/about/">О блоге</a></li>
  </ul>
</div>
</div>

<div id="main">
<h2>Lighttpd: лёгкий веб-сервер для личных нужд</h2>
<h5><i class="icon-feather"></i> 26 октября 2013

 <i class="icon-bookmarks"></i>

<a href="/tags/server.html">Server /</a>

<a href="/tags/linux.html">Linux /</a>

</h5>

<p>Не думалось, что когда-то ещё придётся поднимать веб-сервер на домашней машине. В последнее время это было в целом не нужно, но обстоятельства порой играют нами как тряпичными куклами: никогда не угадаешь, что придётся делать завтра. Как ясно из названия поста, тематика его сводится к установке lighttpd: скромного в своих запросах к ресурсам веб-сервера.</p>

<p>Почему lighttpd? Дело в том, что на домашней машине не слишком-то хочется иметь прожорливый apache, да и наблюдать неспешную сборку его модулей под Gentoo Linux тоже. Выбор был обусловлен лёгкостью и минималистичностью lighttpd, а также относительной простотой его настройки.</p>

<p>Преследуемая конечная цель: водрузить CMS Wordpress. Для этого будем заводить зверинец из lighttpd, mysql, php. Установка последних двух ингридиентов для нашего салата под ОС Windows, помнится, <a href="http://www.unix-lab.org/posts/apache-php-mysql/">уже была описана ранее</a>. Счастливые обладатели Linux могут отыскать всё вышеупомянутое в репозиториях своего дистрибутива.</p>

<p>Применительно к gentoo это выглядит так:</p>
<div class="highlight"><pre><code class="console language-console" data-lang="console"><span class="gp">#</span> emerge -av lighttpd
</code></pre></div>
<p>Если включить соответствующие флаги перед компиляцией, php и mysql подтянутся как зависимости.</p>

<p><a href="http://farm8.staticflickr.com/7424/10452180143_be6e87b74d_o.png"><img src="http://farm8.staticflickr.com/7424/10452180143_be6e87b74d_o.png" alt="lighttpd"></a></p>

<p>Итак, установка завершена. Дабы посмотреть где что лежит, запустите веб-сервер и наберите в адресной строке браузера <a href="http://localhost/info.php">http://localhost/info.php</a>.</p>

<p>Сайты должны располагаться по пути <code>/var/www/localhost/htdocs/</code>. Главный конфигурационный файл lighttpd расположен в <code>/etc/lighttpd/lighttpd.conf</code>. В нём можно управлять настройками вашего веб-сервера. Конфигурационный файл хорошо документирован, поэтому здесь мы лишь слегка окинем его взглядом:</p>
<div class="highlight"><pre><code class="apache language-apache" data-lang="apache"><span class="c"># /etc/lighttpd/lighttpd.conf</span>

<span class="c"># назначение базовой директории веб-сервера, директории для хранения лог-файлов</span>
<span class="err">var</span>.<span class="nb">basedir</span>  = <span class="s2">&quot;/var/www/localhost&quot;</span>
<span class="err">var</span>.<span class="nb">logdir</span>   = <span class="s2">&quot;/var/log/lighttpd&quot;</span>
<span class="err">var</span>.<span class="nb">statedir</span> = <span class="s2">&quot;/var/lib/lighttpd&quot;</span>

<span class="c"># подключаемые модули, нужное раскомментировать</span>

<span class="err">server</span>.<span class="nb">modules</span> = (
<span class="c">#    &quot;mod_rewrite&quot;,</span>
<span class="c">#    &quot;mod_redirect&quot;,</span>
<span class="c">#    &quot;mod_alias&quot;,</span>
    <span class="err">&quot;mod_access&quot;,</span>
    <span class="err">&quot;mod_accesslog&quot;</span>
<span class="err">)</span>

<span class="c"># в mine-types.conf можно управлять распознаванием mime-типов файлов</span>
<span class="nb">include</span> <span class="s2">&quot;mime-types.conf&quot;</span>

<span class="c"># пользователь и группа для управления lighttpd</span>
<span class="err">server</span>.<span class="nb">username</span>      = <span class="s2">&quot;lighttpd&quot;</span>
<span class="err">server</span>.<span class="nb">groupname</span>     = <span class="s2">&quot;lighttpd&quot;</span>
<span class="c"># корневая директория для расположения сайтов</span>
<span class="err">server</span>.<span class="err">document-</span><span class="nb">root</span> = var.basedir + <span class="s2">&quot;/htdocs&quot;</span>
<span class="c"># на каком порту разрешить запуск lighttpd</span>
<span class="err">server</span>.<span class="nb">port</span>          = <span class="m">80</span>
<span class="c"># какие расширения должны использоваться</span>
<span class="c"># выбирать по необходимости</span>
<span class="err">static-file</span>.<span class="err">exclude-</span><span class="nb">extensions</span> = (<span class="s2">&quot;.php&quot;</span>, <span class="s2">&quot;.pl&quot;</span>, <span class="s2">&quot;.cgi&quot;</span>, <span class="s2">&quot;.fcgi&quot;</span>)
</code></pre></div>
<p>Что же, для дальнейшей работы на локальном хосте этого должно быть достаточно. Теперь обратим внимание на mysql.</p>

<p>Перво-наперво, запустим сервис, если это ещё не сделано, и зададим пароль для пользователя <code>root</code>:</p>
<div class="highlight"><pre><code class="console language-console" data-lang="console"><span class="gp">#</span> /etc/init.d/mysql start
<span class="gp">#</span> mysql_secure_installation
</code></pre></div>
<p>Вход с паролем:</p>
<div class="highlight"><pre><code class="console language-console" data-lang="console"><span class="gp">#</span> mysql -u root -p
</code></pre></div>
<p>Разумеется, нам понадобится база данных. Создадим её:</p>
<div class="highlight"><pre><code class="sql language-sql" data-lang="sql"><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">wordpress</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="k">row</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</code></pre></div>
<p>Просмотр всех баз данных:</p>
<div class="highlight"><pre><code class="sql language-sql" data-lang="sql"><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">SHOW</span> <span class="n">DATABASES</span><span class="p">;</span>
<span class="o">+</span><span class="c1">--------------------+</span>
<span class="o">|</span> <span class="k">Database</span>           <span class="o">|</span>
<span class="o">+</span><span class="c1">--------------------+</span>
<span class="o">|</span> <span class="n">information_schema</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">mysql</span>              <span class="o">|</span>
<span class="o">|</span> <span class="n">wordpress</span>          <span class="o">|</span>
<span class="o">+</span><span class="c1">--------------------+</span>
</code></pre></div>
<p>Использовать базу данных по-умолчанию:</p>
<div class="highlight"><pre><code class="sql language-sql" data-lang="sql"><span class="n">mysql</span><span class="o">&gt;</span> <span class="n">USE</span> <span class="n">wordpress</span><span class="p">;</span>
<span class="k">Database</span> <span class="n">changed</span>
</code></pre></div>
<p>Создание нового пользователя:</p>
<div class="highlight"><pre><code class="sql language-sql" data-lang="sql"><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">CREATE</span> <span class="k">USER</span> <span class="s1">&#39;user1&#39;</span><span class="o">@</span><span class="s1">&#39;localhost&#39;</span> <span class="n">IDENTIFIED</span> <span class="k">BY</span> <span class="s1">&#39;password&#39;</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</code></pre></div>
<p>Назначение прав. В примере пользователю <code>user1</code> даются полные права на управление базой данных <code>wordpress</code>:</p>
<div class="highlight"><pre><code class="sql language-sql" data-lang="sql"><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">PRIVILEGES</span> <span class="k">ON</span> <span class="n">wordpress</span><span class="p">.</span><span class="o">*</span> <span class="k">TO</span> <span class="s1">&#39;user1&#39;</span><span class="o">@</span><span class="s1">&#39;localhost&#39;</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</code></pre></div>
<p>Применить изменения:</p>
<div class="highlight"><pre><code class="sql language-sql" data-lang="sql"><span class="n">mysql</span><span class="o">&gt;</span> <span class="n">FLUSH</span> <span class="k">PRIVILEGES</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span> <span class="n">sec</span><span class="p">)</span>
</code></pre></div>
<p>Следующим гвоздём нашей сегодняшней программы выступает Wordpress. Следует скачать архив и распаковаеть его в <code>htdocs</code>:</p>
<div class="highlight"><pre><code class="console language-console" data-lang="console"><span class="gp">$</span> wget http://ru.wordpress.org/wordpress-3.6.1-ru_RU.zip
<span class="gp">$</span> sudo tar -xvf wordpress-3.6.1-ru_RU.tar.gz
<span class="gp">$</span> sudo mv wordpress/wp-config-example wordpress/wp-config.php
<span class="gp">$</span> sudo vim wordpress/wp-config.php
</code></pre></div>
<p>В файле <code>wp-config.php</code> внесите исправления, соответствующие настройкам вашей БД:</p>
<div class="highlight"><pre><code class="php language-php" data-lang="php"><span class="x">/** Имя базы данных для WordPress */</span>
<span class="x">define(&#39;DB_NAME&#39;, &#39;wordpress&#39;);</span>

<span class="x">/** Имя пользователя MySQL */</span>
<span class="x">define(&#39;DB_USER&#39;, &#39;user1&#39;);</span>

<span class="x">/** Пароль к базе данных MySQL */</span>
<span class="x">define(&#39;DB_PASSWORD&#39;, &#39;password&#39;);</span>

<span class="x">/** Имя сервера MySQL */</span>
<span class="x">define(&#39;DB_HOST&#39;, &#39;localhost&#39;);</span>

<span class="x">/** Кодировка базы данных для создания таблиц. */</span>
<span class="x">define(&#39;DB_CHARSET&#39;, &#39;utf8&#39;);</span>
</code></pre></div>
<p>Если на то есть необходимость, &laquo;подкрутите&raquo; настройки php в <code>/etc/php/cgi-php5.5/php.ini</code>.</p>

<p>Отлично! Мы готовы к установке wordpress. Убедитесь, что Lighttpd и MySQL запущены и откройте в адресной строке браузера ссылку <a href="http://localhost/wordpress/wp-admin/install.php">http://localhost/wordpress/wp-admin/install.php</a>. Процесс установки настолько лёгок, что в дополнительном комментировании вряд ли нуждается.</p>

<p><a href="http://farm6.staticflickr.com/5547/10454192236_d04df27798_b.jpg"><img src="http://farm6.staticflickr.com/5547/10454192236_d04df27798.jpg" alt="wp-login"></a></p>

<p>Перейдя по ссылке <a href="http://localhost/wordpress">http://localhost/wordpress</a>, вы увидите форму для входа в административную панель сайта. В целом, нашу задачу можно считать завершённой. Хотя, если учесть тот факт, что wordpress не предоставит нам возможности удалять/модифицировать свои файлы из административного интерфейса без предварительной настройки ftp, то...</p>

<p>Нет, настраивать ftp персонально для wordpress мы не станем. Лучше дать ему указание замолчать и настроить права доступа.</p>

<p>В конец файла <code>wp-config.php</code> добавим строки:</p>
<div class="highlight"><pre><code class="php language-php" data-lang="php"><span class="x">if(is_admin()) {</span>
<span class="x">  add_filter(&#39;filesystem_method&#39;, create_function(&#39;$a&#39;, &#39;return &quot;direct&quot;;&#39; ));</span>
<span class="x">  define( &#39;FS_CHMOD_DIR&#39;, 0751 );</span>
<span class="x">}</span>
</code></pre></div>
<p>С правами доступа разобраться чуть сложнее. Вообще, предполагается следующее: директориям устанавливаются права 755 или 750. Файлам &mdash; 644 или 640. Конфигурационные файлы, такие как <code>wp-config.php</code>, должны иметь ещё более строгие права доступа. Например, 600.</p>

<p>Смотрим, что имеется сейчас:</p>
<div class="highlight"><pre><code class="console language-console" data-lang="console"><span class="gp">$</span> ls -al /var/www/localhost/htdocs/wordpress/wp-content/

<span class="go">drwxr-xr-x 5 nobody nogroup 4096 сент. 12 03:20 ./</span>
<span class="go">drwxr-xr-x 5 nobody nogroup 4096 окт.  24 14:05 ../</span>
<span class="go">-rw-r--r-- 1 nobody nogroup   28 янв.   9  2012 index.php</span>
<span class="go">drwxr-xr-x 3 nobody nogroup 4096 сент. 12 03:20 languages/</span>
<span class="go">drwxr-xr-x 3 nobody nogroup 4096 сент. 12 03:20 plugins/</span>
<span class="go">drwxr-xr-x 6 nobody nogroup 4096 сент. 12 03:20 themes/</span>
</code></pre></div>
<p>Временно можно дать полный доступ к директориям с плагинами и темами:</p>
<div class="highlight"><pre><code class="console language-console" data-lang="console"><span class="gp">#</span> chmod 777 -R /var/www/localhost/htdocs/wordpress/wp-content/<span class="o">{</span>themes,plugins,uploads<span class="o">}</span>
</code></pre></div>
<p>После внесения всех необходимых изменений вернуть первым двум директориям права 755, а с последней не производить никаких манипуляций.</p>

<p>Или сделать иначе: изменить владельца.</p>
<div class="highlight"><pre><code class="console language-console" data-lang="console"><span class="gp">#</span> chown lighttpd -R /var/www/localhost/htdocs/wordpress/wp-content
</code></pre></div>
<p>Также можно воспользоваться плагином File Permissions &amp; Size Check и проверить нравятся ли ему указанные вами права доступа.</p>


<br />
<p align="center"><a href="#">наверх</a></p>
<br />
<div id="comments"></div>
<script type="text/javascript" class="juvia">
(function() {
    var options = {
        container   : '#comments',
        site_key    : 'gcquc3fefcn3kyoj7jstkb7ic8f90cw',
        topic_key   : '/posts/lighttpd',
        topic_url   : 'http://www.unix-lab.org/posts/lighttpd',
        topic_title : 'Lighttpd: лёгкий веб-сервер для личных нужд' || 'http://www.unix-lab.org/posts/lighttpd',
        include_base: !window.Juvia,
        include_css : !window.Juvia
    };

    function makeQueryString(options) {
        var key, params = [];
        for (key in options) {
            params.push(
                encodeURIComponent(key) +
                '=' +
                encodeURIComponent(options[key]));
        }
        return params.join('&');
    }

    function makeApiUrl(options) {
        // Makes sure that each call generates a unique URL, otherwise
        // the browser may not actually perform the request.
        if (!('_juviaRequestCounter' in window)) {
            window._juviaRequestCounter = 0;
        }

        var result =
            'http://juvia-unixlab.rhcloud.com/api/show_topic.js' +
            '?_c=' + window._juviaRequestCounter +
            '&' + makeQueryString(options);
        window._juviaRequestCounter++;
        return result;
    }

    var s       = document.createElement('script');
    s.async     = true;
    s.type      = 'text/javascript';
    s.className = 'juvia';
    s.src       = makeApiUrl(options);
    (document.getElementsByTagName('head')[0] ||
     document.getElementsByTagName('body')[0]).appendChild(s);
})();
</script>



</div>
</div>
<div id="footer-wrapper">
<ul class="footer">
   <a href="/tags/android.html" class="set-1">android</a> <a href="/tags/arch.html" class="set-3">arch</a> <a href="/tags/blog.html" class="set-1">blog</a> <a href="/tags/debian.html" class="set-1">debian</a> <a href="/tags/decorations.html" class="set-1">decorations</a> <a href="/tags/editors.html" class="set-1">editors</a> <a href="/tags/gentoo.html" class="set-1">gentoo</a> <a href="/tags/git.html" class="set-1">git</a> <a href="/tags/kernel.html" class="set-1">kernel</a> <a href="/tags/latex.html" class="set-1">latex</a> <a href="/tags/linux.html" class="set-5">linux</a> <a href="/tags/python.html" class="set-2">python</a> <a href="/tags/ruby.html" class="set-1">ruby</a> <a href="/tags/server.html" class="set-2">server</a> <a href="/tags/web.html" class="set-1">web</a> <a href="/tags/windows.html" class="set-1">windows</a>
</ul>
<ul class="footer">
    <li class="footer">&copy; 2011&mdash;2013 ::</li>
    <li class="footer"><a href="/">unix-lab.org</a> ::</li>
    <li class="footer">licensed under <a href="http://creativecommons.org/licenses/by-nc/3.0/deed.ru">CC BY-NC</a></li>
</ul>
</div>

</body>
</html>
