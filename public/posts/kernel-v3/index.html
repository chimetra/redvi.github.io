<!DOCTYPE html>
<html lang="ru">
<head>

  <title>Ядерная физика для домохозяек v.3 | UNIX-LAB.ORG</title>
  <meta name="description" content="Автору захотелось немного обновить информацию о сборке ядра, за которым уже давно закреплена циферка три.">

  <meta charset="utf-8">
  <meta name="author" content="redVi">
  <meta name='yandex-verification' content='494a81ecb0e796d6' />
  <meta name="viewport" content="initial-scale=1.0, width=device-width" />
  <link rel="icon" href="http://www.unix-lab.org/favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="http://www.unix-lab.org/favicon.ico" type="image/x-icon">
  <link href="http://www.unix-lab.org/assets/stylesheets/screen.css" rel="stylesheet" type="text/css" />
  <link rel="alternate" type="application/atom+xml" title="UNIX-LAB.ORG" href="http://www.unix-lab.org/feeds/atom.xml">
  <link rel="alternate" type="application/rss+xml" title="UNIX-LAB.ORG" href="http://www.unix-lab.org/feeds/rss.xml">
</head>
<body>
<div id="outer-wrapper">
<div id="header-wrapper">
    <a href="/"><div class="logo"></div></a>
    <div class="small">блог об операционных системах, open source и программировании</div>
<div class="nav">
  <ul>
    <li><a href="/archive/">Архив</a></li>
    <li><a href="/about/">О блоге</a></li>
    <li><a href="/author/">Автор</a></li>
  </ul>
</div>
</div>

<div id="main">
<h2>Ядерная физика для домохозяек v.3</h2>
<h5><i class="icon-feather"></i> 19 апреля 2013

 <i class="icon-bookmarks"></i>

<a href="/tags/gentoo.html">Gentoo /</a>

<a href="/tags/kernel.html">Kernel /</a>

<a href="/tags/linux.html">Linux /</a>

</h5>

<p>Достаточно давно была написана отличная статья, послужившая верой и правдой многим линуксоидам, кто самостоятельно собирал  своё ядро. Называлась она &laquo;Ядерная физика для домохозяек, версия 2&raquo;. Ранее, когда деревья были выше, небо голубее, а настольные компьютеры не столь производительны, сборка ядра под своё железо могла внести весомый вклад в увеличение производительности железного друга. Теперь это уже не столь важно и в большинстве случаев даже не нужно, ибо прирост будет незначительным. Да и среднестатистический линуксоид как-то обмельчал, &laquo;скуксился&raquo; что ли.</p>

<p>Тем не менее, автору захотелось немного обновить информацию о сборке ядра, за которым уже давно закреплена циферка три.</p>

<h2 id="toc_0">Оглавление:</h2>

<ul>
<li><a href="#begin">Вступление или подготовка к сборке ядра</a></li>
<li><a href="#general">General setup</a></li>
<li><a href="#modules">Enable loadable module support</a></li>
<li><a href="#block_layer">Enable the block layer</a></li>
<li><a href="#processor">Processor type and features</a></li>
<li><a href="#power">Power management and ACPI options</a></li>
<li><a href="#bus">Bus options (PCI etc.)</a></li>
<li><a href="#emulations">Executable file formats / Emulations</a></li>
<li><a href="#networking">Networking support</a></li>
<li><a href="#device">Device Drivers</a></li>
<li><a href="#firmware">Firmware Drivers</a></li>
<li><a href="#filesystem">File systems</a></li>
<li><a href="#kernel_hack">Kernel hacking</a></li>
<li><a href="#security">Security options</a></li>
<li><a href="#crypto">Cryptographic API</a></li>
<li><a href="#virtu">Virtualization</a></li>
<li><a href="#library">Library routines</a></li>
<li><a href="#end">Послесловие</a></li>
</ul>

<h2 id="toc_1"><a id="begin"></a>Вступление или подготовка к сборке ядра</h2>

<p>Для сборки можно использовать ядро с <a href="http://kernel.org/">kernel.org</a>. Если вам удобнее собрать ядро, поставляемое с вашим дистрибутивом, вы можете смело пропустить этот шаг.</p>

<p>Пройдите по указанной выше ссылке и скачайте ядро <code>Latest Stable Kernel</code>. Должен скачаться файл примерно с таким наименованием: <code>linux-3.6.11.tar.bz2</code>.</p>

<p>Помимо этого, иногда вам может понадобиться поставить заплатки для ядра. Если вы не знаете, что это, значит оно вам и не нужно. Хотя мы рассмотрим процесс наложения заплаток для полноты картины. Получить их можно всё на том же сайте.</p>

<p>Рекомендация по собственно сборке ядра одна на все дистрибутивы, что естественно. А вот инструмент для сборки вполне возможно, что придётся доустановить. Для gentoo это пакет <code>gentoo-sources</code> (если предполагается сборка дистрибутивного ядра). Для дебиана понадобится установить <a href="http://www.unix-lab.org/posts/debian-kernel/">целую пачку пакетов</a>, для арча  понадобится пакет <code>base-devel</code> и <a href="http://www.unix-lab.org/posts/abs/">эта инструкция</a>.</p>

<p>Перед сборкой неплохо сесть и подумать какое же ядро собрать. Ядро может быть:</p>

<p><b>- монолитным</b></p>

<p>такое ядро полностью грузится при старте системы и остаётся в оперативной памяти до выключения машины. Его компоненты нельзя изменить, невозможно подгружать и выгружать модули благодаря чему ядро становится нечувствительным к различным троянским программам, направленным на подмену оригинальных модулей своими - это просто невозможно. Но с другой стороны монолитность ядра привносит и некоторые минусы, такие как невозможность установить стороннюю прошивку или проприетарный драйвер для видеокарты (ведь его модуль нельзя будет подгрузить!). То есть для домашних машин лучше не использовать монолитные ядра, а вот для серверов - самое оно.</p>

<p><b>- модульным</b></p>

<p>это ядро напротив позволит включать многие компоненты не жёстко, а модульно (соответственно своему названию), что уменьшит размер ядра и сделает возможным... да, загрузку и выгрузку нужных модулей. В готовых дистрибутивах для создания такого ядра используется initramfs (раньше - initrd). Но при сборке под себя можно обойтись и без него, достаточно лишь жёстко встроить поддержку файловой системы и контроллёра HD корневого раздела для того, чтобы система смогла определить их и загрузиться.</p>

<p><b>Считаю небезынтересным:</b> <a href="http://teleology.mobi/ru/news_ru/15032006-01_ru">в чём разница между initrd и initramfs</a>.</p>

<p>Обычно предлагается включить в ядро жёстко те компоненты, которые нужны вам постоянно,  а те, что предполагается использовать время от времени, включить модулями.</p>

<p>Итак, вы скачали ядро и заплатки. Переместите их в каталог <code>/usr/src/</code> и сами перейдите в него.
Теперь следует распаковать исходники ядра и архивы с заплатками, наложить заплатки:</p>
<div class="highlight"><pre><code class="console language-console" data-lang="console"><span class="gp">#</span> tar xvf linux-3.6.11.tar.bz2
<span class="gp">#</span> cp patch-3.6.11.bz2 linux-3.6.11/
<span class="gp">#</span> bzip2 -d patch-3.6.11.bz2
<span class="gp">#</span> patch -p1 -i patch-3.6.11.bz2
</code></pre></div>
<p>При наложении заплаток есть лишь один нюанс: сначала накладывается заплатка для обновления версии ядра (<code>patch-$VERSION.bz2</code> как дано выше) и уже затем все остальные.</p>

<p>Обратите внимание на вывод команды <code>patch</code>. Если заплатка идеально подходит к ядру, то в выводе должны быть только строчки <code>patching file ...</code> . Строка <code>Hunk #1 succeeded at...</code> означает что заплатка наложена успешно, но место наложения сдвинуто на несколько строк. Если же вы увидите слово <code>Failed</code> &mdash;  заплатка не подходит. Лучше удалить каталог <code>linux-3.6.11/</code> и начать все сначала уже без этой заплатки.</p>

<p>Далее могут выполнены следующие команды:</p>

<p><code>make mrproper</code> - очистит каталог от мусора предыдущей сборки</p>

<p><code>make menuconfig</code> - запустит окно настроек ядра</p>

<p><code>[ * ]</code> - опция включена жёстко</p>

<p><code>[M]</code> - опция включена модульно</p>

<p><code>[   ]</code> - опция отключена</p>

<p>Вы можете воспользоваться поиском по параметрам ядра, для этого нажмите <code>&quot;/&quot;</code> (слеш) и введите искомое. Также не забывайте о справке: остановитесь на параметре, подробное описание которого вам хотелось бы видеть, и выбирайте <code>&quot;Help&quot;</code> внизу экрана.</p>

<h2 id="toc_2"><a id="general"></a>General setup</h2>

<p>Содержит общие настройки</p>

<p><img src="http://2.bp.blogspot.com/-7mAvCkWeVM8/URjy9WQGCpI/AAAAAAAAD6o/3EliCC8WGl4/s1600/general.jpg" alt="gen"></p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">[*] Prompt for development and/or incomplete code/drivers
</code></pre></div>
<p>Некоторые вещи, которые поддерживает Linux (таких, как сетевые драйверы, файловые системы, сетевые протоколы и т.д.) могут находиться в состоянии  разработки, где функциональность, стабильность или уровень тестирование еще не достаточно высоки для общего использования. То есть данная опция включает дополнительные экспериментальные настройки. Рекомендуется включить, чтобы отображались все доступные опции.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">()  Local version - append to kernel release
</code></pre></div>
<p>Сюда можно внести наименование, которым дополнится название вашего ядра. Бывает полезно, когда вы собираете несколько ядер одной и той же версии. Обычно не нужно.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">Kernel compression mode (Gzip)  ---&gt;
  (X) Gzip
  ( ) Bzip2
  ( ) LZMA
  ( ) XZ
  ( ) LZO
</code></pre></div>
<p>Доступные алгоритмы сжатия, отличающиеся по скорости, эффективности, компрессии и декомпрессии. Скорость сжатия имеет значение только при сборке ядра.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">[*] Support for paging of anonymous memory (swap)
</code></pre></div>
<p>Поддержка ядром своп-файла. Включаем.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">[*] System V IPC
    [*] POSIX Message Queues
    [*] BSD Process Accounting
    [ ] BSD Process Accounting version 3 file format
</code></pre></div>
<p><code>System V IPC</code> &mdash; механизм связи между процессами. Набор библиотечных функций и вызовов ядра, позволяющий процессам обмениваться информацией. Некоторые программы требуют этого механизма.</p>

<p><code>POSIX Message Queues</code> &mdash; очередь для сообщений формата POSIX с использованием приоритетов. Часть механизма связи между процессами. Нужно, если запускать программы написанные под этот формат, например с ОС Solaris.</p>

<p><code>BSD Process Accounting</code> &mdash; поддержка дополнительных сведений о процессах (время запуска, владелец, командная строка запуска, использование памяти). Полезно для контроля процессов.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">[*] Auditing support
    [*] Enable system-call auditing support
    [ ] Make audit loginuid immutable
</code></pre></div>
<p><code>Auditing support</code> &mdash; включение механизма проверки ядра. Например используется системой SELinux (система расширенной безопасности для Linux).</p>

<p><code>Enable system-call auditing support</code> &mdash; включение системных вызовов для механизма проверки ядра.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">&lt;*&gt; Kernel .config support
</code></pre></div>
<p>Сохранять настройки ядра в нем самом. Это полезно, если у Вы удалите папку с исходниками ядра, а потом захотите немного изменить ядро.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">[*] Enable access to .config through /proc/config.gz
</code></pre></div>
<p>Если эта опция включена, вы сможете получать параметры текущего ядра из <code>/proc/config.gz</code></p>

<p>Рекомендуется включить. Пригодится.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">[*] Control Group support  ---&gt;

    [ ] Example debug cgroup subsystem
    [*] Freezer cgroup subsystem
    [ ] Device controller for cgroups
    [*] Cpuset support
    [*] Include legacy /proc/&lt;pid&gt;/cpuset file
    [*] Simple CPU accounting cgroup subsystem
    [*] Resource counters
    [ ] Memory Resource Controller for Control Groups
    [ ] HugeTLB Resource Controller for Control Groups
    [ ] Enable perf_event per-cpu per-container group
    [*] Group CPU scheduler  ---&gt;
        [*] Group scheduling for SCHED_OTHER
        [ ] Group scheduling for SCHED_RR/FIFO
    [ ] Block IO controller
</code></pre></div>
<p>Поддержка группирования процессов. Используется такими подсистемами как CPUSETS, CFS, контроль памяти или устройства изоляции.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">-*- Namespaces support  ---&gt;
</code></pre></div>
<p>Позволяет двум процессам в разных виртуальных средах иметь один и тот же <code>pid</code>. Эта возможность делает реальными такие сценарии, как апгрейд сервера без необходимости его перезагрузки.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">-*- Kernel-&gt;user space relay support (formerly relayfs)
</code></pre></div>
<p>Включает поддержку интерфейса некоторых файловых систем (таких как debugfs). Предназначена для эффективного механизма передачи больших объёмов данных из пространства ядра в пользовательское пространство.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">[*] Initial RAM filesystem and RAM disk (initramfs/initrd) support
</code></pre></div>
<p>Поддержка initrd/initramfs.</p>

<p>Если собирается ядро без оных, следует отключить опцию.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">[ ] Optimize for size
</code></pre></div>
<p>Оптимизация кода ядра по размеру. Может быть полезно для создания загрузочных дискет. В обычных случаях не требуется.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">[ ] Profiling support
</code></pre></div>
<p>Включение расширенной поддержки профилирования (например, OProfile). Обычно не нужно.</p>

<h2 id="toc_3"><a id="modules"></a>Enable loadable module support</h2>

<p><img src="http://3.bp.blogspot.com/-0nYTc8R2UEg/URjzyeN4GkI/AAAAAAAAD6w/MSQG9xGKxmA/s1600/module-support.jpg" alt="loadable"></p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">[ ] Forced module loading
[*] Module unloading
[*] Forced module unloading
[ ] Module versioning support
[ ] Source checksum for all modules
</code></pre></div>
<p>Создание модульного ядра. <code>Module unloading</code> &mdash; возможность выгрузки модулей.</p>

<p><code>Forced module unloading</code> &mdash; возможность принудительной выгрузки модуля, даже если оно еще нужно ядру</p>

<h2 id="toc_4"><a id="block_layer"></a>Enable the block layer</h2>

<p><img src="http://2.bp.blogspot.com/-JYbKPuIuiUY/URkV2DrabvI/AAAAAAAAD9s/CJTpjqyt8p0/s1600/block.png" alt="block"></p>

<p>Поддержка блочных устройств. Если эта опция отключена, некоторые файловые системы станут недоступны (например, ext3), SCSI и USB устройства не смогут распознаться.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">[*] Block layer SG support v4
  Partition Types  ---&gt;
    [*] Advanced partition selection
    [ ] Macintosh partition map support
    [*] PC BIOS (MSDOS partition tables) support
    [ ] BSD disklabel (FreeBSD partition tables) support
    [ ] SGI partition support
    [ ] EFI GUID Partition support
</code></pre></div>
<p>Следует выбрать из списка типы разделов, поддержка которых вам необходима. PC BIOS для машин с обычным BIOS (на разделах MBR), EFI GUID &mdash; EFI BIOS (на разделах GPT). В общем, ясно из названий.</p>

<h2 id="toc_5"><a id="processor"></a>Processor type and features</h2>

<p><img src="http://4.bp.blogspot.com/-acxZBgZhDrM/URjz-aUPpxI/AAAAAAAAD64/f2ycGH2KWxI/s1600/processor.jpg" alt="processors"></p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">[*] Symmetric multi-processing support
</code></pre></div>
<p>Поддержка симметричной мультипроцессорности. Включается в случае, если у вас многопроцессорный компьютер или многоядерный процессор.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">[*] Enable MPS table
</code></pre></div>
<p>Для старых систем SMP, которые не имеют надлежащей поддержки ACPI.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">[ ] Support for extended (non-PC) x86 platforms
</code></pre></div>
<p>Поддержка платформ, отличных от PC.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">[ ] Paravirtualized guest support  ---&gt;
</code></pre></div>
<p>Поддержка паравиртуализации (например, для Xen).</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">Processor family (Core 2/newer Xeon)  ---&gt;

  ( ) Opteron/Athlon64/Hammer/K8
  ( ) Intel P4 / older Netburst based Xeon
  (X) Core 2/newer Xeon
  ( ) Intel Atom
  ( ) Generic-x86-64
</code></pre></div>
<p>Следует выбрать тип своего процессора. Если не знаете или рассчитываете использовать созданную конфигурацию ядра на разных машинах, отмечайте Generic.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">[*] SMT (Hyperthreading) scheduler support
</code></pre></div>
<p>Включение технологии Hyperthreading.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">[*] Multi-core scheduler support
</code></pre></div>
<p>Для процессоров Intel Core, AMD Athlon64/Phenom.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">[ ] EFI runtime service support
[ ] EFI stub support
</code></pre></div>
<p>Для поддержки UEFI. В данном примере она отключена.</p>

<h2 id="toc_6"><a id="power"></a>Power management and ACPI options</h2>

<p><img src="http://2.bp.blogspot.com/-CP-A0xP_xYw/URj0FO2XwFI/AAAAAAAAD7A/IxYaxnx5UOE/s1600/power.jpg" alt="power"></p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">[*] Suspend to RAM and standby
</code></pre></div>
<p>Поддержка Suspend to RAM - сохранение состояния операционной системы в оперативной памяти.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">[*] Hibernation (aka &#39;suspend to disk&#39;)
()  Default resume partition
</code></pre></div>
<p>Поддержка Suspend to Disk - иначе говоря, режим гибернации. Потребуется включение swap-раздела. В <code>Default resume partition</code> можно прописать путь к swap. Или оставить пустым с последующим внесением параметра resume в строку загрузчика. Лучше прописать к загрузчику.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">[*] ACPI(Advanced Configuration and Power Interface)Support ---&gt;
    &lt;M&gt; EC read/write access through /sys/kernel/debug/ec
    [ ] Deprecated /proc/acpi/event support
    &lt;M&gt; AC Adapter
    &lt;M&gt; Battery
    {M} Button
    {M} Video
    &lt;M&gt; Fan
    [*] Dock
    &lt;M&gt; Processor
    &lt;M&gt; Thermal Zone
</code></pre></div>
<p>Поддержка интерфейса управления конфигурацией и питанием (ACPI).</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">CPU Frequency scaling  ---&gt;
  [*] CPU Frequency scaling
  &lt; &gt; CPU frequency translation statistics
  Default CPUFreq governor (ondemand)  ---&gt;
  -*- &#39;performance&#39; governor
  &lt; &gt; &#39;powersave&#39; governor
  &lt; &gt; &#39;userspace&#39; governor
  -*- &#39;ondemand&#39; cpufreq policy governor
  &lt; &gt; &#39;conservative&#39; cpufreq governor
</code></pre></div>
<p>Управление настройками частоты процессора: <code>&#39;performance&#39;</code> governor обеспечивает наибольшую производительность, <code>&#39;powersave&#39;</code> governor будет стараться снижать частоту процессора, чем увеличит работу от батареи, <code>&#39;ondemand&#39;</code> - нечто среднее. Рекомендуется выбрать <code>&#39;ondemand&#39;</code> в качестве &quot;умолчательного&quot; в  <code>Default CPUFreq governor</code>.</p>

<h2 id="toc_7"><a id="bus"></a>Bus options (PCI etc.)</h2>

<p><img src="http://2.bp.blogspot.com/-i2YQe9Ga0iA/URj0I7HFtzI/AAAAAAAAD7I/Y-ZCDexB374/s1600/bus.jpg" alt="bus"></p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">[*] PCI support
[*] Support mmconfig PCI config space access
[*] PCI Express support
&lt; &gt; PCI Express Hotplug driver
[*] Root Port Advanced Error Reporting support
</code></pre></div>
<p>PCI support обеспечивает поддержку шины PCI.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">&lt;*&gt; PCCard (PCMCIA/CardBus) support  ---&gt;
</code></pre></div>
<p>Поддержка карт PCMCIA. Чаще всего встречаются на ноутбуках.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">&lt;*&gt; Support for PCI Hotplug  ---&gt;
</code></pre></div>
<p>&quot;Горячее&quot; (на лету) подключение PCI-устройств. Позволяет добавлять и удалять PCI-устройства, даже когда машина включена и работает. В принципе, можно и отключить, поскольку чаще всего эта возможность не используется.</p>

<h2 id="toc_8"><a id="emulations"></a>Executable file formats / Emulations</h2>

<p><img src="http://2.bp.blogspot.com/-9uhqcPjNg9k/URj0NwRzOxI/AAAAAAAAD7Q/yqIMRFiTgrc/s1600/emulations.jpg" alt="exec"></p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">[*] Kernel support for ELF binaries
[*] Write ELF core dumps with partial segments
&lt;*&gt; Kernel support for MISC binaries
[*] IA32 Emulation
</code></pre></div>
<p>Поддержка формата исполняемых файлов ELF. Обязательна к включению.</p>

<h2 id="toc_9"><a id="networking"></a>Networking support</h2>

<p><img src="http://4.bp.blogspot.com/-TEHPgDhBZ4g/USiyiph-I1I/AAAAAAAAEB0/IcFmfNEkRDA/s1600/network.png" alt="net"></p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">Networking options  ---&gt;
</code></pre></div>
<p>В подпунктах включается поддержка протокола TCP/IP, в частности возможность включения/отключения IPv6. Поскольку автор не является специалистом в данной области, детально раздел не рассматривается. Сетевые администраторы, безусловно, найдут для себя множество полезных опций. Для домашнего же использования рекомендуется оставить опции по-умолчанию.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">&lt; &gt;   IrDA (infrared) subsystem support  ---&gt;
</code></pre></div>
<p>Скорее всего включать не понадобится. Обеспечивает поддержку инфракрасного модуля.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">&lt; &gt;   Bluetooth subsystem support  ---&gt;
        Bluetooth device drivers  ---&gt;
</code></pre></div>
<p>Для тех, у кого встроен модуль беспроводной передачи данных bluetooth. Как правило, сейчас это ноутбуки. Хотя ранее bluetooth был достаточно популярен и соответствующие устройства покупались и использовались на настольных ПК.</p>

<p><code>Bluetooth device drivers</code> позволит выбрать из списка поддержку определённого устройства.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">&lt;M&gt;   RF switch subsystem support  ---&gt;
</code></pre></div>
<p>Для ноутбуков, где, как правило, радиопередатчик wifi-чипа включается нажатием клавиши  &quot;Kill Switch&quot;. Если эта клавиша не нажата и передатчик не включен, wi-fi не заведётся. Кстати, если параллельно у вас установлена Windows, обязательно оставьте под ней включенной кнопку wi-fi. В противном случае в linux при попытке включить интерфейс wlan вам будут объяснять, что Kill Switch отключен и включать его будет бесполезно.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">-*-   Wireless  ---&gt;
    &lt;M&gt; cfg80211 - wireless configuration API
    [*] cfg80211 wireless extensions compatibility
</code></pre></div>
<p>Поддержка стандарта 802.11 для беспроводных сетей.</p>

<h2 id="toc_10"><a id="device"></a>Device Drivers</h2>

<p><img src="http://3.bp.blogspot.com/-pVZoCFTdLCE/URj0VtIET6I/AAAAAAAAD7g/UOTlDdAxh0A/s1600/device.jpg" alt="device"></p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">Generic Driver Options  ---&gt;
    (/sbin/hotplug) path to uevent helper
    [*] Maintain a devtmpfs filesystem to mount at /dev
    [*] Automount devtmpfs at /dev, after the kernel mounted the ro
    [*] Select only drivers that don&#39;t need compile-time external fir
    [*] Prevent firmware from being built
     -*- Userspace firmware loading support
    [*] Include in-kernel firmware blobs in kernel binary
    () External firmware blobs to build into the kernel binary
    [ ] Driver Core verbose debug messages
    [*] Managed device resources verbose debug messages
</code></pre></div>
<p><code>Maintain a devtmpfs filesystem to mount at /dev</code> &mdash; Монтировать файловую систему tmpfs.</p>

<p><code>Select only drivers that don&#39;t need compile-time external fir</code> &mdash; выбирать лишь те драйверы, которые не требуют прошивки. В зависимости от вашего оборудования эту опцию, возможно, придётся отключить.</p>

<p><code>Include in-kernel firmware blobs in kernel binary</code> &mdash; включить прошивку в ядро.</p>

<p><code>External firmware blobs to build into the kernel binary</code> &mdash; требуется для указания пути к блобам.</p>

<p>Например:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">radeon/BTC_rls.bin radeon/CAICOS_mc.bin radeon/CAICOS_me.bin radeon/CAICOS_pfp.bin
</code></pre></div>
<p>Но в таком случае требуется включить в конфигурационный файл ядра строку с указанием директории, в которой находятся эти блобы:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">CONFIG_EXTRA_FIRMWARE_DIR=&quot;/lib/firmware&quot;
</code></pre></div>
<p>Идём далее:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">&lt; &gt; Parallel port support  ---&gt;
-*- Plug and Play support  ---&gt;
</code></pre></div>
<p>Первое уже вряд ли нужно. Но если у вас есть устройства ( раньше это были все принтеры ), требующие подключения по параллельному порту - включите опцию.</p>

<p>Plug and Play включаем.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">[*] Block devices  ---&gt;
    &lt;*&gt; Loopback device support
    &lt;*&gt; RAM block device support
</code></pre></div>
<p>Блочные устройства. <code>Loopback device support</code> включить обязательно.</p>

<p><code>RAM block device support</code> нужен при сборке ядра с initrd, в противном случае - отключить: &quot;выбирайте Y, если хотите использовать часть оперативной памяти как блочное устройство. В этом устройстве вы сможете создавать файловую систему, и использовать ее как обыкновенное блочное устройство (такое как жесткий диск). Обычно его используют для загрузки и сохранения минимальной копии корневой файловой системы при загрузке с флоппи диска, CD-ROM при установке дистрибутива, или на бездисковых рабочих станциях.&quot;</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">Misc devices  ---&gt;
</code></pre></div>
<p>Просмотреть и принять решение включать или не включать то или иное устройство. У автора данный раздел вообще пуст.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">SCSI device support  ---&gt;
  -*- SCSI device support
  [*] legacy /proc/scsi/ support
  *** SCSI support type (disk, tape, CD-ROM) ***
  &lt;*&gt; SCSI disk support
  &lt;*&gt; SCSI CDROM support
  [*]   Enable vendor-specific extensions (for SCSI CDROM)
  &lt;*&gt; SCSI generic support
  [*] Verbose SCSI error reporting (kernel size +=12K)
</code></pre></div>
<p>Поддержка устройств SCSI. В современных машинах без включения этих опций могут быть не найдены такие устройства как жёсткий диск и CD-привод.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">&lt;*&gt; Serial ATA and Parallel ATA drivers  ---&gt;
    [*] Verbose ATA error reporting
    [*] ATA ACPI Support
    [*] SATA Port Multiplier support
    *** Controllers with non-SFF native interface ***
    &lt;*&gt; AHCI SATA support
</code></pre></div>
<p>Поддержка устройств SATA. AHCI (Advanced Host Controller Interface) - механизм, позволяющий устройствам SATA пользоваться расширенными функциями.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">[ ] Multiple devices driver support (RAID and LVM)  ---&gt;
</code></pre></div>
<p>Опции, обеспечивающие использование логических томов и программных RAID-массивов.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">[*] Network device support  ---&gt;
    [*]   Ethernet driver support  ---&gt;
    &lt;*&gt;   PPP (point-to-point protocol) support
    USB Network Adapters  ---&gt;
    [*]   Wireless LAN  ---&gt;
</code></pre></div>
<p>В <code>Ethernet driver support</code> следует выбрать поддержку устройства вашей сетевой карты Ethernet. PPP может понадобиться тем, кто подключается к интернету с использованием соответствующего протокола. USB Adapters - при наличии у вас поднобного адаптера для выхода в сеть. Wireless LAN - для использования беспроводных сетей стандарта IEEE 802.11. Здесь нужно выбрать соответствующий вашему оборудованию драйвер.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">Input device support  ---&gt;
</code></pre></div>
<p>Нужен для определения различных устройств ввода как то: мыши, тачпады, тачскрины, джойстики, клавиатура и иные устройства. Предлагается немного побродить по списку и выбрать нужные опции.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">{*} I2C support  ---&gt;
</code></pre></div>
<p>Поддержка видео в Linux.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">&lt;*&gt; Multimedia support  ---&gt;
    [*] Cameras/video grabbers support
    [*] Media USB Adapters  ---&gt;
    &lt;*&gt; USB Video Class (UVC)
    [*] UVC input events device support
</code></pre></div>
<p>Поддержка веб-камер и захвата видео.  Нужно включить, если имеется встроенная камера или предполагается подключать камеру внешнюю.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">Graphics support  ---&gt;
  &lt;*&gt; /dev/agpgart (AGP Support)  ---&gt;
  &lt;*&gt;   AMD Opteron/Athlon64 on-CPU GART support
  &lt;*&gt;   Intel 440LX/BX/GX, I8xx and E7x05 chipset support
</code></pre></div>
<p>Включение поддержки AGP. В примере для видеокарт Intel и Radeon.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">[*] Laptop Hybrid Graphics - GPU switching support
</code></pre></div>
<p>Включается, если на машине более одной видеокарты.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">&lt;M&gt; Direct Rendering Manager
</code></pre></div>
<p>Включить DRM - Direct Rendering Manager. Современная вещь, рекомендуется.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">{*} Support for frame buffer devices  ---&gt;
    [*] Enable Video Mode Handling Helpers
    [*] Enable Tile Blitting Support
    [*] EFI-based Framebuffer Support
</code></pre></div>
<p>Управление поддержкой фреймбуфера. EFI-based Framebuffer Support нужен для систем с UEFI.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">Console display driver support  ---&gt;
   {*} Framebuffer Console support
</code></pre></div>
<p>Поддержка кадрового буфера в консоли. Включаем.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">[*] Bootup logo  ---&gt;
   [*] Standard 224-color Linux logo
</code></pre></div>
<p>Включаем пингвинов при загрузке системы ;)</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">&lt;*&gt; Sound card support  ---&gt;
    &lt;*&gt;   Advanced Linux Sound Architecture  ---&gt;
</code></pre></div>
<p>Включение поддержки звуковых устройств. Выбор своего железа из списка.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">[*] USB support  ---&gt;
</code></pre></div>
<p>Аналогично, только для USB-устройств.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">[*] X86 Platform Specific Device Drivers  ---&gt;
</code></pre></div>
<p>Имеет смысл посмотреть владельцам ноутбуков. Особенно тем, у кого не работает контроль яркости экрана или горячие клавиши. Для владельцев MXM видеокарт там же включить:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">&lt;*&gt; WMI Support for MXM Laptop Graphics
</code></pre></div>
<h2 id="toc_11"><a id="firmware"></a>Firmware Drivers</h2>

<p><img src="http://1.bp.blogspot.com/-3Ils4rVfERs/URj0aMbsLUI/AAAAAAAAD7o/6uomYCkeb-4/s1600/firmware.jpg" alt="firmware"></p>

<p>Для включения в ядро сторонних прошивок. Если вы не уверены, что вам нужны какие-либо опции, рекомендуется оставить вариант по-умолчанию.</p>

<h2 id="toc_12"><a id="filesystem"></a>File systems</h2>

<p><img src="http://4.bp.blogspot.com/--w14rX6P998/URj0fdZaJOI/AAAAAAAAD7w/q3VRKtSfMHo/s1600/file_systems.jpg" alt="filesys"></p>

<p>Осуществляет поддержку тех или иных файловых систем, поддержку квотирования, а также выбор нативных языков (вернее того, как будут отображаться символы). В целом, в комментариях не нуждается. Единственное замечание: если вы собираете ядро без initrd нужно включить используемые при загрузке файловые системы жёстко, а не модулями.</p>

<h2 id="toc_13"><a id="kernel_hack"></a>Kernel hacking</h2>

<p><img src="http://4.bp.blogspot.com/-J7yzSpH6pwo/URj0kIAAWdI/AAAAAAAAD74/n7EhSw4roUA/s1600/kernel_hacking.jpg" alt="kern_hack"></p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">[*] Magic SysRq key
</code></pre></div>
<p>Если компьютер завис и не реагирует на команды переключения консоли. Вы можете нажать <code>Alt-PrintScreen-s</code> для записи кеша дисков или <code>Alt-PrintScreen-i</code> (Убить все процессы за исключением init). Механизм нажатия такой: - Нажать <code>Alt</code> - Нажать <code>PrintScreen</code> - Отпустить <code>Alt</code> - Нажать нужную кнопку - Отпустить все.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">-*- Debug Filesystem
</code></pre></div>
<p>Когда эта опция включена, можно монтировать debugfs в <code>/etc/fstab</code>. Таким образом мы получим директорию <code>/sys/kernel/debug</code>, что очень небесполезно в частности для обладателей двух видеокарт.</p>

<h2 id="toc_14"><a id="security"></a>Security options</h2>

<p><img src="http://4.bp.blogspot.com/-uAfdUZl_GXY/URj0oFWuBLI/AAAAAAAAD8A/t-l_cw-uc3A/s1600/security.jpg" alt="secur"></p>

<p>Позволяет увеличить защищенность системы. Можно, например, запретить запуск программ с привилегиями root без специального ключа или с помощью системы SELinux ограничить возможности доступа к файлам самого root. Изменяйте эти опции только если вы знаете что делаете.</p>

<h2 id="toc_15"><a id="crypto"></a>Cryptographic API</h2>

<p><img src="http://2.bp.blogspot.com/-6GG_ndYOcrs/URj0tE8KRuI/AAAAAAAAD8I/qwdxqJrLm94/s1600/crypto.jpg" alt="cryp"></p>

<p>Опции шифрования. Пригодятся, если у вас имеются закодированные файловые системы. Так же как и с предыдущим пунктом: изменяйте эти опции только если вы знаете что делаете.</p>

<h2 id="toc_16"><a id="virtu"></a>Virtualization</h2>

<p><img src="http://3.bp.blogspot.com/-_heNGKvMZkM/URj0w0T1I1I/AAAAAAAAD8Q/Axf270kguus/s1600/virtualization.jpg" alt="virt"></p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">&lt;M&gt;  Kernel-based Virtual Machine (KVM) support
&lt;M&gt;  KVM for Intel processors support
&lt; &gt;  KVM for AMD processors support
</code></pre></div>
<p>Нужно включить, если планируется использовать виртуализацию (конкретно: VirtualBox или QEMU). В противном случае не отмечайте ничего.</p>

<h2 id="toc_17"><a id="library"></a>Library routines</h2>

<p><img src="http://3.bp.blogspot.com/-6RbJBv52P6Q/URj00UmIdMI/AAAAAAAAD8Y/UscvOhZbCac/s1600/library.jpg" alt="lib"></p>

<p>Используется для предоставления модулям функций CRC32 CRC32c. Можете включить</p>

<h2 id="toc_18"><a id="end"></a>Послесловие</h2>

<p>Итак, настройка ядра закончена. Теперь коснёмся вопроса о сборке. Процесс сборки и установки ядра можно выполнить одной командой:</p>
<div class="highlight"><pre><code class="console language-console" data-lang="console"><span class="gp">#</span> make bzImage modules modules_install install
</code></pre></div>
<p>Когда ядро будет собрано, у Вас должны появиться следующие файлы:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">/boot/vmlinuz-3.6.11
/boot/System.map-3.6.11
/boot/initrd-3.6.11.img
</code></pre></div>
<p>и каталог модулей</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">/lib/modules/3.6.11
</code></pre></div>
<p>И последним шагом подправим строки загрузчика, чтобы можно было загрузиться с новым ядром (пример для grub-legacy):</p>
<div class="highlight"><pre><code class="sh language-sh" data-lang="sh"><span class="c"># /boot/grub/menu.lst</span>
<span class="c">#</span>
default 0
timeout 30
<span class="nv">splashimage</span><span class="o">=(</span>hd0,1<span class="o">)</span>/boot/grub/splash.xpm.gz
title Linux 3.6.11
root <span class="o">(</span>hd0,1<span class="o">)</span>
kernel /boot/vmlinuz-3.6.11 <span class="nv">root</span><span class="o">=</span>/dev/ram0 <span class="nv">real_root</span><span class="o">=</span>/dev/sda3
initrd /boot/initrd-3.6.11
</code></pre></div>
<p>Для тех, кому любопытно собрать ядро без initrd, милости прошу: <a href="http://alv.me/?p=58">лишнему в ядре не место</a>. Хотя и следуя представленным выше указаниям также можно собрать такое ядро. Но статья, приведённая по ссылке, позволит лучше понять зачем это нужно и нужно ли оно вообще.</p>

<p>Единственное, что там не указано: как в этом случае будут выглядеть настройки загрузчика. В них больше не будет указания на initrd &mdash; последней строки &mdash; и ram0:</p>
<div class="highlight"><pre><code class="sh language-sh" data-lang="sh"><span class="c"># /boot/grub/menu.lst</span>
<span class="c">#</span>
title Linux 3.6.11
root <span class="o">(</span>hd0,1<span class="o">)</span>
kernel /boot/vmlinuz-3.6.11 <span class="nv">root</span><span class="o">=</span>/dev/sda3
</code></pre></div>
<p>Если сборка не первая, вы увидите в <code>/boot</code> старое ядро, оно будет выглядеть как <code>vmlinuz-$KERNEL-VERSION.old</code>. В случае неудачной сборки, вы всегда можете загрузиться со старым ядром.</p>

<p><b>P.S:</b> при указанном способе сборки в gentoo автоматически не появится initrd. Если он вам нужен, наиболее простой способ: после сборки ядра использовать для его создания <code>genkernel</code>:</p>
<div class="highlight"><pre><code class="console language-console" data-lang="console"><span class="gp">#</span> genkernel --install initramfs
</code></pre></div>
<p><b>P.S2:</b> не забудьте добавить своего пользователя в соответствующие группы. Если нет звука, прежде всего проверьте, добавлен ли пользователь в группу <code>audio</code>, если не заводится камера &mdash; в группу <code>video</code>.</p>

<p>Да, надо бы ещё отметить, что при необходимости можно обратиться к документации ядра.
Располагаются эти файлы в каталоге <code>/usr/src/linux/Documentation</code>. Вот, вроде бы, и всё.</p>


<br />
<p align="center"><a href="#">наверх</a></p>


</div>
</div>
<div id="footer-wrapper">
<ul class="footer">
   <a href="/tags/android.html" class="set-1">android</a> <a href="/tags/arch.html" class="set-3">arch</a> <a href="/tags/blog.html" class="set-1">blog</a> <a href="/tags/debian.html" class="set-1">debian</a> <a href="/tags/decorations.html" class="set-1">decorations</a> <a href="/tags/editors.html" class="set-1">editors</a> <a href="/tags/gentoo.html" class="set-1">gentoo</a> <a href="/tags/git.html" class="set-1">git</a> <a href="/tags/kernel.html" class="set-1">kernel</a> <a href="/tags/latex.html" class="set-1">latex</a> <a href="/tags/linux.html" class="set-5">linux</a> <a href="/tags/python.html" class="set-2">python</a> <a href="/tags/ruby.html" class="set-1">ruby</a> <a href="/tags/server.html" class="set-2">server</a> <a href="/tags/web.html" class="set-1">web</a> <a href="/tags/windows.html" class="set-1">windows</a>
</ul>
<ul class="footer">
    <li class="footer">&copy; 2011&mdash;2013 ::</li>
    <li class="footer"><a href="/">unix-lab.org</a> ::</li>
    <li class="footer">licensed under <a href="http://creativecommons.org/licenses/by-nc/3.0/deed.ru">CC BY-NC</a></li>
</ul>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', '', '');
  ga('send', 'pageview');

</script>

</body>
</html>
