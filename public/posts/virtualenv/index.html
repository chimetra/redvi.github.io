<!DOCTYPE html>
<html lang="ru">
<head>

  <title>Слово о virtualenv | UNIX-LAB.ORG</title>
  <meta name="description" content="Что такое virtualenv и как с ним работать">

  <meta charset="utf-8">
  <meta name="author" content="redVi">
  <meta name='yandex-verification' content='494a81ecb0e796d6' />
  <meta name="viewport" content="initial-scale=1.0, width=device-width" />
  <link rel="icon" href="http://www.unix-lab.org/favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="http://www.unix-lab.org/favicon.ico" type="image/x-icon">
  <link href="http://www.unix-lab.org/assets/stylesheets/screen.css" rel="stylesheet" type="text/css" />
  <link rel="alternate" type="application/atom+xml" title="UNIX-LAB.ORG" href="http://www.unix-lab.org/feeds/atom.xml">
  <link rel="alternate" type="application/rss+xml" title="UNIX-LAB.ORG" href="http://www.unix-lab.org/feeds/rss.xml">
</head>
<body>
<div id="outer-wrapper">
<div id="header-wrapper">
    <a href="/"><div class="logo"></div></a>
    <div class="small">блог об операционных системах, open source и программировании</div>
<div class="nav">
  <ul>
    <li><a href="/archive/">Архив</a></li>
    <li><a href="/about/">О блоге</a></li>
    <li><a href="/author/">Автор</a></li>
  </ul>
</div>
</div>

<div id="main">
<h2>Слово о virtualenv</h2>
<h5><i class="icon-feather"></i> 29 июня 2013

 <i class="icon-bookmarks"></i>

<a href="/tags/python.html">Python /</a>

</h5>

<p>Так случилось, что на данный момент автор балуется скриптами на <code>python</code> и стоит на пороге изучения Django. Естественно, в такой интересной ситуации нельзя однажды не наткнуться на сложности в работе с несколькими проектами и призванным решить все проблемы <code>virtualenv</code>. Впрочем, о нём уже только ленивый не писал, и если читателю приходилось сталкиваться с указанным приложением, этот пост вряд ли расскажет ему о чём-то новом. Тем не менее, поговорим о виртуальных окружениях.</p>

<h2 id="toc_0">На кой оно нужно?</h2>

<p>Итак, чем может быть полезен <code>virtualenv</code>? Предположим, вы взялись за разработку сайта с использованием python v3 и django v1.5. и всё бы хорошо, да вот незадача: вам срочно понадобилось посмортеть какой-то проект, где автором используются совершенно иные библиотеки и версия <code>python</code>, несовместимая с вашей. Итак, у вас есть два пути: поставить все эти библиотеки и раздельно пользоваться ими, что не есть удобно. Таким образом вы захламляете системные каталоги и спустя какое-то время сам чёрт не разберёт что где лежит и зачем это было нужно. Путь второй заключается в установке <code>virtualenv</code> и использования его возможностей для своих нехитрых нужд.</p>

<p>Virtualenv пригодится для создания виртуальных окружений, внутри которых может использоваться другая версия python, другой набор модулей и приложений для текущей задачи. При этом все модули и приложения не устанавливаются в системные каталоги, а лежат исключительно в указанных директориях виртуального окружения. Их можно удалить по отдельности, а можно просто «снести» каталог виртуального окружения, чтобы избавиться от всего, что там лежит. Неплохо, верно?</p>

<h2 id="toc_1">Установка и использование</h2>

<p>Теперь установим <code>pip</code> и <code>virtualenv</code> и посмотрим, как пользоваться всем этим хозяйством на практике. Прежде всего следует выбрать версию <code>python</code>, которая будет использоваться в создаваемом виртуальном окружении и указать, что мы не хотим использовать системные пакеты:</p>
<div class="highlight"><pre><code class="console language-console" data-lang="console"><span class="gp">$</span> virtualenv -p /usr/bin/python2.7 --no-site-packages ~/.virtualenvs/env2.7

<span class="go">Running virtualenv with interpreter /usr/bin/python2.7</span>
<span class="go">The --no-site-packages flag is deprecated; it is now the default behavior.</span>
<span class="go">New python executable in /home/redvi/.virtualenvs/env2.7/bin/python2.7</span>
<span class="go">Also creating executable in /home/redvi/.virtualenvs/env2.7/bin/python</span>
<span class="go">Installing setuptools..............................done.</span>
<span class="go">Installing pip...............done.</span>
</code></pre></div>
<p>Так, мы создали директорию <code>.virtualenvs</code>, которая будет содержать различные виртуальные окружения и первое виртуальное окружение, которое просто использует <code>python v2.7</code>.
Примечание: если установка прерывается с ошибкой <code>Permission Denied</code>, проверьте не смонтирован ли раздел, где создаётся виртуально окружение, с параметром <code>noexec</code>.
Директория <code>env2.7</code> служит всего лишь примером, вы можете создавать виртуальное окружение под каждый проект, например, назвав его <code>.virtualenvs/myapp</code>.
Теперь нужно активировать виртуальное окружение:</p>
<div class="highlight"><pre><code class="console language-console" data-lang="console"><span class="gp">$</span> <span class="nb">source</span> .virtualenvs/env2.7/bin/activate
</code></pre></div>
<p>Далее, находясь в выбранном виртуальном окружении, установим что-нибудь. К примеру, у автора имеется django v1.5, но захотелось поставить v1.4:</p>
<div class="highlight"><pre><code class="console language-console" data-lang="console"><span class="gp">$</span> pip install <span class="nv">django</span><span class="o">==</span>1.4
<span class="gp">$</span> python
</code></pre></div><div class="highlight"><pre><code class="pycon language-pycon" data-lang="pycon"><span class="gp">&gt;&gt;&gt; </span><span class="n">Python</span> <span class="mf">2.7</span><span class="o">.</span><span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">django</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">django</span><span class="o">.</span><span class="n">VERSION</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;final&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="console language-console" data-lang="console"><span class="gp">$</span> pip uninstall <span class="nv">django</span><span class="o">==</span>1.4

<span class="go">Uninstalling Django:</span>
<span class="go">/home/user/.virtualenvs/env2.7/bin/django-admin.py</span>
<span class="go">/home/user/.virtualenvs/env2.7/lib/python2.7/site-packages/Django-1.4-py2.7.egg-info</span>
<span class="go">/home/user/.virtualenvs/env2.7/lib/python2.7/site-packages/django</span>
<span class="go">Proceed (y/n)? y</span>
<span class="go">Successfully uninstalled Django</span>
</code></pre></div>
<p>Думаю, этот пример достаточно показателен. При установке Django 1.4 вы не обнаружите его в системных каталогах — только в <code>.virualenv/env2.7</code>
Чтобы выйти из виртуального окружения введите команду <code>$ deactivate</code>.</p>

<p>Примечание: <code>pip</code> — небольшая и очень удобная программа, которая позволяет устанавливать и удалять python-приложения в одну команду. <code>Pip</code> можно установить как из репозиториев вашего дистрибутива для всей системы, так и в рамках окружения <code>virtualenv</code>.</p>

<h2 id="toc_2">О virtualenvwrapper</h2>

<p>В иных руководствах рекомендуется использовать вдовесок <code>virtualenvwrapper</code>, призванный упростить работу с самим <code>virtualenv</code>. Думается, он не особенно нужен, ибо единственной вещью, которую делать лениво представляется переключение между виртуальными окружениями: слишком длинную команду приходится вводить для такого простого действия. Но это можно легко поправить, добавив в ваш <code>.bashrc</code> или <code>.zshrc</code> несколько псевдонимов для окружений, например так:</p>
<div class="highlight"><pre><code class="sh language-sh" data-lang="sh"><span class="nb">alias </span><span class="nv">env3</span><span class="o">=</span><span class="s1">&#39;source ~/.virtualenvs/env3.2/bin/activate&#39;</span>
<span class="nb">alias </span><span class="nv">env2</span><span class="o">=</span><span class="s1">&#39;source ~/.virtualenvs/env2.7/bin/activate&#39;</span>
<span class="nb">alias </span><span class="nv">blog</span><span class="o">=</span><span class="s1">&#39;source ~/.virtualenvs/blog/bin/activate&#39;</span>
</code></pre></div>
<p>Теперь смена окружения будет выглядеть немного иначе:</p>

<ul>
<li><code>$ evn2</code> -- вошли в окружение, работаем работу</li>
<li><code>$ deactivate</code> -- деактивируем окружение</li>
<li><code>$ env3</code> -- входим в другое окружение</li>
</ul>

<p>При использовании <code>virtualenvwrapper</code>:</p>

<ul>
<li><code>$ mkvirtualenv myapp</code> -- создаст новое окружение myapp</li>
<li><code>$ workon myapp</code> -- переключиться на myapp</li>
<li><code>$ deactivate</code> -- деактивировать</li>
<li><code>$ rmvirtualenv myapp</code> -- удалить</li>
</ul>

<p>Официальная документация проекта: <a href="http://virtualenv.org">http://virtualenv.org</a></p>


<br />
<p align="center"><a href="#">наверх</a></p>


</div>
</div>
<div id="footer-wrapper">
<ul class="footer">
   <a href="/tags/android.html" class="set-1">android</a> <a href="/tags/arch.html" class="set-3">arch</a> <a href="/tags/blog.html" class="set-1">blog</a> <a href="/tags/debian.html" class="set-1">debian</a> <a href="/tags/decorations.html" class="set-1">decorations</a> <a href="/tags/editors.html" class="set-1">editors</a> <a href="/tags/gentoo.html" class="set-1">gentoo</a> <a href="/tags/git.html" class="set-1">git</a> <a href="/tags/kernel.html" class="set-1">kernel</a> <a href="/tags/latex.html" class="set-1">latex</a> <a href="/tags/linux.html" class="set-5">linux</a> <a href="/tags/python.html" class="set-2">python</a> <a href="/tags/ruby.html" class="set-1">ruby</a> <a href="/tags/server.html" class="set-2">server</a> <a href="/tags/web.html" class="set-1">web</a> <a href="/tags/windows.html" class="set-1">windows</a>
</ul>
<ul class="footer">
    <li class="footer">&copy; 2011&mdash;2013 ::</li>
    <li class="footer"><a href="/">unix-lab.org</a> ::</li>
    <li class="footer">licensed under <a href="http://creativecommons.org/licenses/by-nc/3.0/deed.ru">CC BY-NC</a></li>
</ul>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', '', '');
  ga('send', 'pageview');

</script>

</body>
</html>
